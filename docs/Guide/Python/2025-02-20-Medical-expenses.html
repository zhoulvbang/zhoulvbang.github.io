<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Simonzhou">
<meta name="dcterms.date" content="2025-02-21">

<title>用Python处理一份卫生费用数据 – 医学统计学笔记</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../Guide/SAS/SAS-intro.html" rel="next">
<link href="../../Guide/Python/Python-intro.html" rel="prev">
<link href="../../images/logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-471db41ce322a552900897f16bd8eadd.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-39599dd41c217de25ded3edcfc388f1c.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-G2HZEXHNCE"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-G2HZEXHNCE', { 'anonymize_ip': true});
</script>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "classic",
  "openSidebar": false,
  "showHighlights": "always",
  "enableExperimentalNewNoteButton": true
}
</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>


<meta property="og:title" content="用Python处理一份卫生费用数据 – 医学统计学笔记">
<meta property="og:description" content="This is a Note site.">
<meta property="og:image" content="www.lazyzhou.cn/Med-Stat-Notes/Guide/Python/logo.png">
<meta property="og:site_name" content="医学统计学笔记">
<meta name="twitter:title" content="用Python处理一份卫生费用数据 – 医学统计学笔记">
<meta name="twitter:description" content="This is a Note site.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">医学统计学笔记</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-learn" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Learn</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-learn">    
        <li>
    <a class="dropdown-item" href="../../Learn/Basic/00-basic.html">
 <span class="dropdown-text">Basic</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-guide" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Guide</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-guide">    
        <li>
    <a class="dropdown-item" href="../../Guide/Guide-intro.html">
 <span class="dropdown-text">Guide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Guide/Python/Python-intro.html">
 <span class="dropdown-text">Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Guide/R/R-intro.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Guide/SAS/SAS-intro.html">
 <span class="dropdown-text">SAS</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-quarto" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Quarto</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-quarto">    
        <li>
    <a class="dropdown-item" href="../../Quarto/quarto-intro.html">
 <span class="dropdown-text">Intro</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../navbar/book.html"> 
<span class="menu-text">Books</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/zhoulvbang" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../Guide/Guide-intro.html">统计软件使用指南</a></li><li class="breadcrumb-item"><a href="../../Guide/Python/Python-intro.html">Python introduction</a></li><li class="breadcrumb-item"><a href="../../Guide/Python/2025-02-20-Medical-expenses.html">用Python处理一份卫生费用数据</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">主页</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../Learn/Basic/00-basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">医学统计学基础</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../Learn/Basic/00-basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">医学统计学基础</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Learn/Basic/01-preview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preview</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../Guide/Guide-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">统计软件使用指南</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../Guide/R/R-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R introduction</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Guide/R/R-install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R install</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Guide/R/2025-02-22-CLHLS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CLHLS Data Analysis by R</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../Guide/Python/Python-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Guide/Python/2025-02-20-Medical-expenses.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">用Python处理一份卫生费用数据</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../Guide/SAS/SAS-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SAS introduction</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Guide/SAS/SAS-install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SAS Install</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Guide/SAS/2025-02-16-CLHLS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">使用SAS处理CLHLS数据</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../Quarto/quarto-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../Quarto/yaml_settings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">YAML设置</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../Guide/Guide-intro.html">统计软件使用指南</a></li><li class="breadcrumb-item"><a href="../../Guide/Python/Python-intro.html">Python introduction</a></li><li class="breadcrumb-item"><a href="../../Guide/Python/2025-02-20-Medical-expenses.html">用Python处理一份卫生费用数据</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">用Python处理一份卫生费用数据</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Simonzhou </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 21, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="用python处理卫生费用数据" class="level1">
<h1>用Python处理卫生费用数据</h1>
<p>本篇博客用来记录2025年1月到2月帮助学弟处理一份某二级医院2018-2023年的医疗费用，最开始用的Stata，但是越往后，越感觉到Stata的难用，以及AI对这种程序的支持程度极其有限，随改用Python来继续完成相关的分析。</p>
<section id="必须配置" class="level2">
<h2 class="anchored" data-anchor-id="必须配置">必须配置</h2>
<p>运行此文档需要电脑上以安装Python，并且下列包已被安装并且能被调用：</p>
<p><code>numpy jupyter-cache pandas openpyxl</code></p>
<p>你可以使用 <code>pip</code> 或 <code>conda</code> 进行安装： <code>pip install jupyter-cache</code></p>
</section>
<section id="初步认识数据" class="level2">
<h2 class="anchored" data-anchor-id="初步认识数据">初步认识数据</h2>
<p>我们可以使用<code>pandas</code>包来查看部分原始数据，数据的基本样式如下：</p>
<div id="f44ecd7d" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 安装并加载必要的包</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 导入 Excel 文件</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">"C:/Users/asus/Desktop/test/stata/prepare.xlsx"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_excel(file_path, sheet_name<span class="op">=</span><span class="dv">0</span>, engine<span class="op">=</span><span class="st">'openpyxl'</span>)     </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 随机抽取10个样本数据</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>sample_data <span class="op">=</span> data.sample(n<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 打印样本数据</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sample_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      次数        出生日期 性别   年龄      医疗付费方式  国籍 新生儿出生体重 新生儿入院体重  \
1138   1  1956-09-06  男  61岁    新型农村合作医疗  中国       －       －   
2024   1  1959-08-15  女  59岁  城镇居民基本医疗保险  中国       －       －   
1605   1  1973-02-05  女  45岁    新型农村合作医疗  中国       －       －   
1975  11  2012-09-20  男   6岁    新型农村合作医疗  中国       －       －   
1701   1  1963-01-23  男  55岁         全自费  中国       －       －   
218    1  1969-06-08  女  48岁    新型农村合作医疗  中国       －       －   
1344   1  1960-09-11  女  57岁    新型农村合作医疗  中国       －       －   
252    1  1944-05-01  女  73岁    新型农村合作医疗  中国       －       －   
1921   5  2013-10-17  女   5岁    新型农村合作医疗  中国       －       －   
643    1  1997-09-02  男  20岁         全自费  中国       －       －   

                     出生地         籍贯  ... 麻醉开始时间3 麻醉结束时间3 麻醉方式3 麻醉分级3 切口部位3  \
1138           福建省莆田市秀屿区  福建省莆田市秀屿区  ...     NaN     NaN   NaN   NaN   NaN   
2024               福建莆田市         莆田  ...     NaN     NaN   NaN   NaN   NaN   
1605                 福建省          闽  ...     NaN     NaN   NaN   NaN   NaN   
1975              莆田市荔城区     福建省莆田市  ...     NaN     NaN   NaN   NaN   NaN   
1701                福建莆田       福建莆田  ...     NaN     NaN   NaN   NaN   NaN   
218                  福建省     福建省莆田市  ...     NaN     NaN   NaN   NaN   NaN   
1344  福建省福清市渔溪镇联华村火烧埔36号         福建  ...     NaN     NaN   NaN   NaN   NaN   
252                福建莆田市         莆田  ...     NaN     NaN   NaN   NaN   NaN   
1921           福建省莆田市城厢区     福建省莆田市  ...     NaN     NaN   NaN   NaN   NaN   
643                 北京通县       北京通县  ...     NaN     NaN   NaN   NaN   NaN   

     切口等级3  NNIS分级3 手术部位感染3 术前住院天数3  手术持续时间3  
1138   NaN      NaN     NaN     NaN      NaN  
2024   NaN      NaN     NaN     NaN      NaN  
1605   NaN      NaN     NaN     NaN      NaN  
1975   NaN      NaN     NaN     NaN      NaN  
1701   NaN      NaN     NaN     NaN      NaN  
218    NaN      NaN     NaN     NaN      NaN  
1344   NaN      NaN     NaN     NaN      NaN  
252    NaN      NaN     NaN     NaN      NaN  
1921   NaN      NaN     NaN     NaN      NaN  
643    NaN      NaN     NaN     NaN      NaN  

[10 rows x 202 columns]</code></pre>
</div>
</div>
<p>我们可以看到，该数据的列很多，第一张表中有220列，我们需要对其进行一些筛选。</p>
</section>
<section id="对数据的思考" class="level2">
<h2 class="anchored" data-anchor-id="对数据的思考">对数据的思考</h2>
<p>从哪里开始是一个需要思考的问题，对于数据的认识决定了你处理问题的方向和效率。首先，理解数据的来源至关重要，这包括了解数据是如何收集的、收集过程中可能出现的偏差或错误。其次，明确数据的类型与结构也是关键步骤之一，不同类型的数据（如定量数据、定性数据）需要采用不同的分析方法。再者，对数据进行初步探索，比如通过可视化手段观察数据分布特征，或是计算一些基本统计量来了解数据的基本情况，能够帮助你更好地制定数据处理策略。</p>
<p>在真正开始处理数据之前，还需要考虑你的目标是什么。是为了回答一个具体的问题，还是为了探索潜在的模式？明确了目标之后，才能有针对性地选择合适的工具和技术。此外，考虑到数据质量的问题，数据清洗是不可跳过的一步，它包括去除异常值、填补缺失值等操作，这对于提高分析结果的准确性非常关键。</p>
<p>最后，保持对数据伦理的关注同样重要，在整个数据分析的过程中，确保遵循相关的隐私保护法规和道德标准，这样才能确保你的工作不仅有效，而且负责任。通过对数据全面而深刻的理解，你可以更加自信地从数据中提取有价值的信息，并为决策提供有力支持。</p>
<section id="合并数据" class="level3">
<h3 class="anchored" data-anchor-id="合并数据">合并数据</h3>
<p>这份Excel文件有6张sheet，分别是2018-2023年，首先需要检查这六张sheet中的变量是否一致：</p>
<div id="d324d571" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 导入 Excel 文件</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">"C:/Users/asus/Desktop/test/stata/prepare.xlsx"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>sheet_names <span class="op">=</span> [<span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2023"</span>]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取所有 sheet 的数据</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>sheets_data <span class="op">=</span> {sheet: pd.read_excel(file_path, sheet_name<span class="op">=</span>sheet) <span class="cf">for</span> sheet <span class="kw">in</span> sheet_names}</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取每个 sheet 的列名</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>sheets_columns <span class="op">=</span> {sheet: <span class="bu">set</span>(data.columns) <span class="cf">for</span> sheet, data <span class="kw">in</span> sheets_data.items()}</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 找出所有 sheet 的共同变量和不一致的变量</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>common_columns <span class="op">=</span> <span class="bu">set</span>.intersection(<span class="op">*</span>sheets_columns.values())</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>all_columns <span class="op">=</span> <span class="bu">set</span>.union(<span class="op">*</span>sheets_columns.values())</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>inconsistent_columns <span class="op">=</span> all_columns <span class="op">-</span> common_columns</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 打印结果</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"一致的变量名:"</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(common_columns)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">不一致的变量名:"</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(inconsistent_columns)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 打印每个 sheet 的变量</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sheet, columns <span class="kw">in</span> sheets_columns.items():</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>sheet<span class="sc">}</span><span class="ss"> 的变量: </span><span class="sc">{</span>columns<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>一致的变量名:
{'NNIS分级2', '手术操作名称2', '出院诊断', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '是否非计划重返手术室病例2', '切口部位1', '9.3手术用一次性医用材料费', '8.3球蛋白类制品费', '入院诊断', '术前预防性抗菌药物给药时间1', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '3.5手术费', '切口部位2', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '择期手术1', '4手术时间', '病案质量', '麻醉方式2', '腔镜手术名称2', '6手术时间', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '是否有出院31天内再住院计划', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '级别1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '手术结束时间2', '婚姻', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '离院方式', '8.5细胞因子类制品费', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '药占比%'}

不一致的变量名:
{'择期手术3', '7麻醉方式', '7愈合', '4麻醉医师', 'NNIS分级3', '7手术时间', '手术次数3', '切口等级3', '7切口', '手术开始时间3', '8手术编码', '7手术名称', '麻醉开始时间3', '8切口', '8级别', '术前住院天数3', '8手术时间', '8手术名称', '手术结束时间3', '手术操作编码3', '麻醉方式3', '手术操作名称3', '8麻醉方式', '手术持续时间3', '7手术编码', '愈合2', '8愈合', '7级别', '手术部位感染3', '麻醉结束时间3', '切口部位3', '是否微创手术2', '4麻醉方式', '麻醉分级3'}

2018 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '术前预防性抗菌药物给药时间1', '手术开始时间3', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '3.5手术费', '切口部位2', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '手术操作名称3', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术持续时间3', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '4麻醉方式', '择期手术3', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '切口等级3', '6手术时间', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '麻醉开始时间3', '3手术名称', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '手术结束时间3', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '麻醉方式3', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '手术次数3', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '级别1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '手术结束时间2', '婚姻', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '麻醉分级3', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', 'NNIS分级3', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '术前住院天数3', '3手术编码', '麻醉分级2', '新生儿出生体重', '离院方式', '8.5细胞因子类制品费', '手术操作编码3', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '愈合2', '8.4凝血因子类制品费', '职业', '手术部位感染3', '2.1病理诊断费', '麻醉结束时间3', '5.中医治疗费', '年龄', '切口部位3', '是否药物过敏', '是否有出院31天内再住院计划', '是否微创手术2'}

2019 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '7愈合', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '术前预防性抗菌药物给药时间1', '手术开始时间3', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '3.5手术费', '切口部位2', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '手术操作名称3', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '4麻醉方式', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '6手术时间', '7切口', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '手术结束时间3', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '7麻醉方式', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '手术次数3', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '7手术编码', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '级别1', '手术结束时间2', '婚姻', '7级别', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '7手术时间', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '7手术名称', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '离院方式', '8.5细胞因子类制品费', '手术操作编码3', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '愈合2', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '是否有出院31天内再住院计划', '是否微创手术2'}

2020 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '7愈合', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '8手术编码', '术前预防性抗菌药物给药时间1', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '8切口', '3.5手术费', '切口部位2', '8手术时间', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '4麻醉方式', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '6手术时间', '7切口', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '8级别', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '7麻醉方式', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '8麻醉方式', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '7手术编码', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '级别1', '手术结束时间2', '8愈合', '婚姻', '7级别', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '7手术时间', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '7手术名称', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '8手术名称', '离院方式', '8.5细胞因子类制品费', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '是否有出院31天内再住院计划'}

2021 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '7愈合', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '8手术编码', '术前预防性抗菌药物给药时间1', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '8切口', '3.5手术费', '切口部位2', '8手术时间', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '4麻醉方式', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '6手术时间', '7切口', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '8级别', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '7麻醉方式', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '8麻醉方式', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '7手术编码', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '级别1', '手术结束时间2', '8愈合', '婚姻', '7级别', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '7手术时间', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '7手术名称', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '8手术名称', '离院方式', '8.5细胞因子类制品费', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '是否有出院31天内再住院计划'}

2022 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '7愈合', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '8手术编码', '术前预防性抗菌药物给药时间1', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '8切口', '3.5手术费', '切口部位2', '8手术时间', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '4麻醉方式', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '6手术时间', '7切口', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '8级别', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '7麻醉方式', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '8麻醉方式', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '7手术编码', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '级别1', '手术结束时间2', '8愈合', '婚姻', '7级别', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '7手术时间', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '7手术名称', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '8手术名称', '离院方式', '8.5细胞因子类制品费', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '是否有出院31天内再住院计划'}

2023 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '7愈合', '4麻醉医师', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '8手术编码', '术前预防性抗菌药物给药时间1', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '8切口', '3.5手术费', '切口部位2', '8手术时间', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '6手术时间', '7切口', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '8级别', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '7麻醉方式', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '8麻醉方式', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '7手术编码', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '级别1', '手术结束时间2', '8愈合', '婚姻', '7级别', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '7手术时间', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '7手术名称', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '8手术名称', '离院方式', '8.5细胞因子类制品费', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '是否有出院31天内再住院计划'}</code></pre>
</div>
</div>
<p>然后剔除不一致的变量数据，同时创建一个新变量<code>year</code>，用sheet的年份对其进行填充，再按变量名对应合并6张表格的数据称为一张总表，命名为<code>merge-sheet.xlsx</code>输出到你需要存放数据的文件夹中。</p>
<p>变量还是太多了，那接下来对变量进行筛选，首先我们可以对所有键值为空的变量进行剔除，或者根据实际的研究需要，剔除一部分键值全部为null的变量。</p>
<p>这里我选择对键值全部为null或0的变量进行剔除。</p>
<p>第一次尝试的时候，打开表后进行查看，发现变量顺序很乱，没有按照原始顺序进行排列，处理办法则是在前面的变量筛选部分使用<code>DataFrame</code>的<code>loc</code>方法选择列，同时保持列的顺序。</p>
<p>同时为了节省时间，因为在Quarto中运行Python代码很慢，暂时还不知道原因，待以后调试一下。所以最后用一个程序解决上述这些问题，节省时间。</p>
<div id="2545505f" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 导入 Excel 文件</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">"C:/Users/asus/Desktop/test/stata/prepare.xlsx"</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> <span class="st">"C:/Users/asus/Desktop/test/stata/data/merge-data.xlsx"</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>final_output_path <span class="op">=</span> <span class="st">"C:/Users/asus/Desktop/test/stata/data/cleaned-merge-data.xlsx"</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>sheet_names <span class="op">=</span> [<span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2023"</span>]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取所有 sheet 的数据</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>sheets_data <span class="op">=</span> {sheet: pd.read_excel(file_path, sheet_name<span class="op">=</span>sheet) <span class="cf">for</span> sheet <span class="kw">in</span> sheet_names}</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取每个 sheet 的列名</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>sheets_columns <span class="op">=</span> {sheet: <span class="bu">set</span>(data.columns) <span class="cf">for</span> sheet, data <span class="kw">in</span> sheets_data.items()}</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 找出所有 sheet 的共同变量</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>common_columns <span class="op">=</span> <span class="bu">set</span>.intersection(<span class="op">*</span>sheets_columns.values())</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 保持原始顺序</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>common_columns <span class="op">=</span> <span class="bu">list</span>(common_columns)  </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 剔除不一致的变量数据，并添加 year 变量</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sheet, data <span class="kw">in</span> sheets_data.items():</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    sheets_data[sheet] <span class="op">=</span> data[<span class="bu">list</span>(common_columns)]</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    sheets_data[sheet][<span class="st">'year'</span>] <span class="op">=</span> sheet</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 合并所有 sheet 的数据</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>merged_data <span class="op">=</span> pd.concat(sheets_data.values(), ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 输出合并后的数据到指定路径</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>merged_data.to_excel(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 重新导入合并后的数据</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>merged_data <span class="op">=</span> pd.read_excel(output_path)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 剔除键值全部为 null 或 0 的变量，同时保持原始变量的顺序</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>non_null_columns <span class="op">=</span> merged_data.dropna(axis<span class="op">=</span><span class="dv">1</span>, how<span class="op">=</span><span class="st">'all'</span>).columns</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>non_zero_columns <span class="op">=</span> merged_data.loc[:, (merged_data <span class="op">!=</span> <span class="dv">0</span>).<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">0</span>)].columns</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>valid_columns <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> merged_data.columns <span class="cf">if</span> col <span class="kw">in</span> non_null_columns <span class="kw">and</span> col <span class="kw">in</span> non_zero_columns]</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>cleaned_data <span class="op">=</span> merged_data.loc[:, valid_columns]</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 输出清理后的数据到指定路径</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>cleaned_data.to_excel(final_output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"清理后的数据已输出到 </span><span class="sc">{</span>final_output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="co"># 展示部分数据</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="co"># 随机抽取10个样本数据</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>sample_data <span class="op">=</span> cleaned_data.sample(n<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 打印样本数据</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sample_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>清理后的数据已输出到 C:/Users/asus/Desktop/test/stata/data/cleaned-merge-data.xlsx
      NNIS分级2          手术操作名称2  \
14033     NaN              NaN   
8455      NaN              NaN   
26016     NaN              NaN   
11010     NaN              NaN   
31721     NaN              NaN   
48837      0级  白内障摘除伴人工晶体一期置入术   
31786     NaN              NaN   
35260     NaN              NaN   
9815      NaN              NaN   
16671     NaN              NaN   

                                                    出院诊断  2.3影像学诊断费  \
14033  老年性白内障|H25.900|有,玻璃体混浊|H43.300|有,眼底出血|H35.602|...         32   
8455   特指手术后状态|Z98.800|有,并指[趾]畸形|Q70.900|有,特指手术后状态|Z9...         96   
26016  尘肺|J64.x00x001|有,肺部感染|J98.414|有,胸腔积液|J94.804|有...          0   
11010  颈椎间盘突出|M50.201|有,颈椎退行性病变|M48.901|有,高血压病|I10.x0...          0   
31721  子宫内膜息肉|N84.001|有,女性盆腔炎性疾病|N73.900|有,宫颈息肉|N84.1...          0   
48837                                  老年核性白内障|H25.100|有         36   
31786  多处挫伤|T00.901|有,多发性脑梗死|I63.905|有,支气管扩张伴感染|J47.x...          0   
35260  多发性结肠息肉|K63.504|临床未确定,直肠息肉|K62.100|临床未确定,慢性萎缩性...          0   
9815   多发性结肠息肉|K63.504|有,慢性结肠炎|K52.910|有,甲状腺结节|E04.101|有          0   
16671  腰椎间盘突出|M51.202|有,腰椎退行性病变|M48.903|有,原发性单侧膝关节病|M...          0   

      是否有使用抗菌药物2 NNIS分级1 输液反应  4级别 是否非计划重返手术室病例2 切口部位1  ... 8.1血费  3愈合  \
14033        NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   
8455         NaN     NaN  NaN  NaN           NaN   NaN  ...  32.2  NaN   
26016        NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   
11010        NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   
31721        NaN     NaN  NaN  1.0           NaN   NaN  ...  34.0   其他   
48837          无      0级    无  NaN             否    左眼  ...   0.0  NaN   
31786        NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   
35260        NaN     NaN  NaN  1.0           NaN   NaN  ...   0.0    甲   
9815         NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   
16671        NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   

             2手术编码 6手术编码              手术开始时间1    职业   年龄 是否药物过敏  药占比%  year  
14033          NaN   NaN                  NaN    农民  66岁      无    2%  2020  
8455           NaN   NaN                  NaN    工人  47岁      无   14%  2019  
26016          NaN   NaN                  NaN  退休人员  67岁      无   24%  2021  
11010          NaN   NaN                  NaN    职员  66岁      无    0%  2019  
31721  68.1200x001   NaN                  NaN    农民  34岁      无   12%  2021  
48837  13.7100x001   NaN  2023-12-29 17:50:40    农民  72岁      无    1%  2023  
31786          NaN   NaN                  NaN    其他  74岁      无   40%  2021  
35260  45.4300x013   NaN                  NaN    其他  62岁      无    6%  2022  
9815           NaN   NaN                  NaN  城乡居民  32岁      无    4%  2019  
16671          NaN   NaN                  NaN    居民  62岁      无    0%  2020  

[10 rows x 160 columns]</code></pre>
</div>
</div>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("www\.lazyzhou\.cn\/Med-Stat-Notes");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="zhoulvbang/comments" data-repo-id="R_kgDON9RmWA" data-category="General" data-category-id="DIC_kwDON9RmWM4CnLUH" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../Guide/Python/Python-intro.html" class="pagination-link" aria-label="Python introduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Python introduction</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../Guide/SAS/SAS-intro.html" class="pagination-link" aria-label="SAS introduction">
        <span class="nav-page-text">SAS introduction</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb7" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "用Python处理一份卫生费用数据"</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="an">number-sections:</span><span class="co"> false</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> false</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2025-02-21"</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Simonzhou"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> html</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu"># 用Python处理卫生费用数据</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>本篇博客用来记录2025年1月到2月帮助学弟处理一份某二级医院2018-2023年的医疗费用，最开始用的Stata，但是越往后，越感觉到Stata的难用，以及AI对这种程序的支持程度极其有限，随改用Python来继续完成相关的分析。</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## 必须配置</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>运行此文档需要电脑上以安装Python，并且下列包已被安装并且能被调用：</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="in">`numpy jupyter-cache pandas openpyxl`</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>你可以使用 <span class="in">`pip`</span> 或 <span class="in">`conda`</span> 进行安装： <span class="in">`pip install jupyter-cache`</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="fu">## 初步认识数据</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>我们可以使用<span class="in">`pandas`</span>包来查看部分原始数据，数据的基本样式如下：</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, cache=true}</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="in"># 安装并加载必要的包</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="in">import pandas as pd</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="in">import numpy as np</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="in"># 导入 Excel 文件</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="in">file_path = "C:/Users/asus/Desktop/test/stata/prepare.xlsx"</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="in">data = pd.read_excel(file_path, sheet_name=0, engine='openpyxl')     </span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="in"># 随机抽取10个样本数据</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="in">sample_data = data.sample(n=10, random_state=42)</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="in"># 打印样本数据</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="in">print(sample_data)</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>我们可以看到，该数据的列很多，第一张表中有220列，我们需要对其进行一些筛选。</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="fu">## 对数据的思考</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>从哪里开始是一个需要思考的问题，对于数据的认识决定了你处理问题的方向和效率。首先，理解数据的来源至关重要，这包括了解数据是如何收集的、收集过程中可能出现的偏差或错误。其次，明确数据的类型与结构也是关键步骤之一，不同类型的数据（如定量数据、定性数据）需要采用不同的分析方法。再者，对数据进行初步探索，比如通过可视化手段观察数据分布特征，或是计算一些基本统计量来了解数据的基本情况，能够帮助你更好地制定数据处理策略。</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>在真正开始处理数据之前，还需要考虑你的目标是什么。是为了回答一个具体的问题，还是为了探索潜在的模式？明确了目标之后，才能有针对性地选择合适的工具和技术。此外，考虑到数据质量的问题，数据清洗是不可跳过的一步，它包括去除异常值、填补缺失值等操作，这对于提高分析结果的准确性非常关键。</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>最后，保持对数据伦理的关注同样重要，在整个数据分析的过程中，确保遵循相关的隐私保护法规和道德标准，这样才能确保你的工作不仅有效，而且负责任。通过对数据全面而深刻的理解，你可以更加自信地从数据中提取有价值的信息，并为决策提供有力支持。</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="fu">### 合并数据</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>这份Excel文件有6张sheet，分别是2018-2023年，首先需要检查这六张sheet中的变量是否一致：</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{python,cache=true}</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="in">import pandas as pd</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a><span class="in"># 导入 Excel 文件</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a><span class="in">file_path = "C:/Users/asus/Desktop/test/stata/prepare.xlsx"</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a><span class="in">sheet_names = ["2018", "2019", "2020", "2021", "2022", "2023"]</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a><span class="in"># 读取所有 sheet 的数据</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a><span class="in">sheets_data = {sheet: pd.read_excel(file_path, sheet_name=sheet) for sheet in sheet_names}</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a><span class="in"># 获取每个 sheet 的列名</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a><span class="in">sheets_columns = {sheet: set(data.columns) for sheet, data in sheets_data.items()}</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a><span class="in"># 找出所有 sheet 的共同变量和不一致的变量</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a><span class="in">common_columns = set.intersection(*sheets_columns.values())</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a><span class="in">all_columns = set.union(*sheets_columns.values())</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a><span class="in">inconsistent_columns = all_columns - common_columns</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a><span class="in"># 打印结果</span></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a><span class="in">print("一致的变量名:")</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a><span class="in">print(common_columns)</span></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a><span class="in">print("\n不一致的变量名:")</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a><span class="in">print(inconsistent_columns)</span></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a><span class="in"># 打印每个 sheet 的变量</span></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a><span class="in">for sheet, columns in sheets_columns.items():</span></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a><span class="in">    print(f"\n{sheet} 的变量: {columns}")</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>然后剔除不一致的变量数据，同时创建一个新变量<span class="in">`year`</span>，用sheet的年份对其进行填充，再按变量名对应合并6张表格的数据称为一张总表，命名为<span class="in">`merge-sheet.xlsx`</span>输出到你需要存放数据的文件夹中。</span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>变量还是太多了，那接下来对变量进行筛选，首先我们可以对所有键值为空的变量进行剔除，或者根据实际的研究需要，剔除一部分键值全部为null的变量。</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>这里我选择对键值全部为null或0的变量进行剔除。</span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>第一次尝试的时候，打开表后进行查看，发现变量顺序很乱，没有按照原始顺序进行排列，处理办法则是在前面的变量筛选部分使用<span class="in">`DataFrame`</span>的<span class="in">`loc`</span>方法选择列，同时保持列的顺序。</span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>同时为了节省时间，因为在Quarto中运行Python代码很慢，暂时还不知道原因，待以后调试一下。所以最后用一个程序解决上述这些问题，节省时间。</span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, cache=true}</span></span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a><span class="in">import pandas as pd</span></span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a><span class="in"># 导入 Excel 文件</span></span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a><span class="in">file_path = "C:/Users/asus/Desktop/test/stata/prepare.xlsx"</span></span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a><span class="in">output_path = "C:/Users/asus/Desktop/test/stata/data/merge-data.xlsx"</span></span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a><span class="in">final_output_path = "C:/Users/asus/Desktop/test/stata/data/cleaned-merge-data.xlsx"</span></span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a><span class="in">sheet_names = ["2018", "2019", "2020", "2021", "2022", "2023"]</span></span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a><span class="in"># 读取所有 sheet 的数据</span></span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a><span class="in">sheets_data = {sheet: pd.read_excel(file_path, sheet_name=sheet) for sheet in sheet_names}</span></span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a><span class="in"># 获取每个 sheet 的列名</span></span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a><span class="in">sheets_columns = {sheet: set(data.columns) for sheet, data in sheets_data.items()}</span></span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a><span class="in"># 找出所有 sheet 的共同变量</span></span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a><span class="in">common_columns = set.intersection(*sheets_columns.values())</span></span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a><span class="in"># 保持原始顺序</span></span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a><span class="in">common_columns = list(common_columns)  </span></span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a><span class="in"># 剔除不一致的变量数据，并添加 year 变量</span></span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a><span class="in">for sheet, data in sheets_data.items():</span></span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a><span class="in">    sheets_data[sheet] = data[list(common_columns)]</span></span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a><span class="in">    sheets_data[sheet]['year'] = sheet</span></span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a><span class="in"># 合并所有 sheet 的数据</span></span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a><span class="in">merged_data = pd.concat(sheets_data.values(), ignore_index=True)</span></span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a><span class="in"># 输出合并后的数据到指定路径</span></span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a><span class="in">merged_data.to_excel(output_path, index=False)</span></span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a><span class="in"># 重新导入合并后的数据</span></span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a><span class="in">merged_data = pd.read_excel(output_path)</span></span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a><span class="in"># 剔除键值全部为 null 或 0 的变量，同时保持原始变量的顺序</span></span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a><span class="in">non_null_columns = merged_data.dropna(axis=1, how='all').columns</span></span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a><span class="in">non_zero_columns = merged_data.loc[:, (merged_data != 0).any(axis=0)].columns</span></span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a><span class="in">valid_columns = [col for col in merged_data.columns if col in non_null_columns and col in non_zero_columns]</span></span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a><span class="in">cleaned_data = merged_data.loc[:, valid_columns]</span></span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a><span class="in"># 输出清理后的数据到指定路径</span></span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a><span class="in">cleaned_data.to_excel(final_output_path, index=False)</span></span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a><span class="in">print(f"清理后的数据已输出到 {final_output_path}")</span></span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a><span class="in"># 展示部分数据</span></span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a><span class="in"># 随机抽取10个样本数据</span></span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a><span class="in">sample_data = cleaned_data.sample(n=10)</span></span>
<span id="cb7-147"><a href="#cb7-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-148"><a href="#cb7-148" aria-hidden="true" tabindex="-1"></a><span class="in"># 打印样本数据</span></span>
<span id="cb7-149"><a href="#cb7-149" aria-hidden="true" tabindex="-1"></a><span class="in">print(sample_data)</span></span>
<span id="cb7-150"><a href="#cb7-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 This website was built with Quarto
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2025, simonzhou</p>
<div class="toc-actions"><ul><li><a href="https://github.com/zhoulvbang/Med-Stat-Notes/blob/main/Guide/Python/2025-02-20-Medical-expenses.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/zhoulvbang/Med-Stat-Notes/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/zhoulvbang">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>