[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "医学统计学习笔记",
    "section": "",
    "text": "本书的前身是开始于23年暑假的Rmarkdown笔记的制作，在考研的过程中，一些无聊又不想学习的时间被用来整理这些笔记和制作文档与网页，由于Quarto的出现和发展，感觉到它的强大与便利，遂用Quarto重制。\n现在重制这本学习笔记，按照初步构想，会继续完善卫生/医学统计学部分的内容，从低阶往高阶完善；再就是记录相关程序的使用技巧和学习记录（R、Python、SAS etc.)；还有有一部分的项目分享（如果顺利的话）和读书报告。\nEpidemiologists, in response to a health emergency or as a result of systematic surveillance, first obtain and analyze observed data. They use data, observations, science, and theory as they work at identifying a pathogen (when unknown) behind an observed disease outbreak or as they proceed to plan or implement policies that ameliorates its impact.\n按照大类再细分的话会有如下：\n\n统计学\n\n医学统计学（基础篇）\n贝叶斯统计\n最大似然统计\n\n统计软件的使用\n\nR\nPython\nSAS\nStata\nQuarto\n\n项目记录\n\nKaggle\n\n读书笔记\n\n\n\nCitationBibTeX citation:@online{2025,\n  author = {, simonzhou},\n  title = {医学统计学习笔记},\n  date = {2025-02-27},\n  url = {https://github.com/zhoulvbang/Med-Stat-Notes},\n  langid = {en}\n}\nFor attribution, please cite this work as:\nsimonzhou. 2025. “医学统计学习笔记.” February 27, 2025. https://github.com/zhoulvbang/Med-Stat-Notes.",
    "crumbs": [
      "Home",
      "主页"
    ]
  },
  {
    "objectID": "statistics-basic/test.html",
    "href": "statistics-basic/test.html",
    "title": "初识医学统计学",
    "section": "",
    "text": "rmarkdown",
    "crumbs": [
      "Home",
      "医学统计学基础",
      "初识医学统计学"
    ]
  },
  {
    "objectID": "Quarto/yaml_settings.html",
    "href": "Quarto/yaml_settings.html",
    "title": "YAML设置",
    "section": "",
    "text": "Quarto主要由三大部分组成：metadata, text, 和 code。其中metadata是文档开头写在”—“之间的句子，它采用的是YAML语法，所以有时候也被叫做YAML metadata 或者 the YAML frontmatter。YAML定义了Quarto文档的各种属性，比如编译文件类型、主题、代码块的执行行为以及目录等。在YAML metadata中采用正确的缩进十分重要。",
    "crumbs": [
      "Home",
      "Quarto introduction",
      "YAML设置"
    ]
  },
  {
    "objectID": "Quarto/yaml_settings.html#sec-dateformat",
    "href": "Quarto/yaml_settings.html#sec-dateformat",
    "title": "YAML设置",
    "section": "\n2.1 date-format的设置",
    "text": "2.1 date-format的设置\ndate-format通过以下关键词来定义日期格式：\n\n\n\n\n\n\n\nStyle\nDescription\nExample\n\n\n\nfull\nA full date that includes the weekday name\nMonday, March 7, 2005\n\n\nlong\nA long date that includes a wide month name\nMarch 7, 2005\n\n\nmedium\nA medium date\nMar 7, 2005\n\n\nshort\nA short date with a numeric month\n3/7/05\n\n\niso\nA short date in ISO format\n2005-03-07\n\n\n\n也可以通过以下语法更加灵活的定义日期格式：\n\n\n\n\n\n\n\normat String\nOutput\nDescription\n\n\n\nYY\n18\nTwo-digit year\n\n\nYYYY\n2018\n四位数年份\n\n\nM\n1-12\nThe month, beginning at 1\n\n\nMM\n01-12\n两位数月份\n\n\nMMM\nJan-Dec\nThe abbreviated month name\n\n\nMMMM\nJanuary-December\nThe full month name\n\n\nD\n1-31\nThe day of the month\n\n\nDD\n01-31\n两位数日期\n\n\nd\n0-6\nThe day of the week, with Sunday as 0\n\n\ndd\nSu-Sa\nThe min name of the day of the week\n\n\nddd\nSun-Sat\nThe short name of the day of the week\n\n\ndddd\nSunday-Saturday\nThe name of the day of the week\n\n\nH\n0-23\nThe hour\n\n\nHH\n00-23\n两位数小时，24小时制\n\n\nh\n1-12\nThe hour, 12-hour clock\n\n\nhh\n01-12\nThe hour, 12-hour clock, 2-digits\n\n\nm\n0-59\nThe minute\n\n\nmm\n00-59\n两位数分钟\n\n\ns\n0-59\nThe second\n\n\nss\n00-59\nThe second, 2-digits\n\n\nSSS\n000-999\nThe millisecond, 3-digits\n\n\nZ\n+05:00\nThe offset from UTC, ±HH:mm\n\n\nA\nAM PM\n\n\n\na\nam pm\n\n\n\nDo\n1st 2nd … 31st\nDay of Month with ordinal\n\n\n\n可以通过”[]“添加自定义字符。通过这些语法，可以定制符合中文语法的日期格式，如：date-format: \"YYYY[年]M[月]D[日] HH:mm\"\n\n\n\n\n\n\nTip\n\n\n\n关于日期的详细指南，详见：https://quarto.org/docs/reference/dates.html。",
    "crumbs": [
      "Home",
      "Quarto introduction",
      "YAML设置"
    ]
  },
  {
    "objectID": "Quarto/yaml_settings.html#编译html",
    "href": "Quarto/yaml_settings.html#编译html",
    "title": "YAML设置",
    "section": "\n10.1 编译HTML",
    "text": "10.1 编译HTML\n\n---\nformat: \n  html:\n    theme: \n      light: flatly \n      dark: darkly \n    embed-resources: false\n    code-tools: true\n    title-block-banner: images/banner.jpg \n    title-block-banner-color: \"black\"\n    toc: true\n    toc-title: 目录\n    toc-location: left\n    toc-depth: 2\n    toc-expand: 1\n    number-sections: true\n    number-depth: 3\n    anchor-sections: true\n    link-external-icon: true\n    link-external-newwindow: true\n    df-print: kable \n    code-link: true\n---\n\n\ntheme：主题。同 Section 3 。\nembed-resources：是否将所有源文件嵌入HTML文件以方便分享。默认为”false”。\ncode-tools：是否在网页右上角显示”&lt;code&gt;“按钮。点击该按钮可以看到Quarto文档的原始markdown代码。\n\ntitle-block-banner：标题横幅设置。title-block-banner有以下选项：\n\ntrue：将标题以网页横幅的形式展示，样式为them中所选样式的默认样式。\n具体颜色：如title-block-banner: \"#003262\"。\n图片路径：如title-block-banner: images/banner.jpeg。\n\n\ntoc相关设置：同 Section 4 。\nnumber-sections、number-depth：同 Section 5 。\nanchor-sections: 设置为true时，当鼠标移到各级标题上时会显示anchor link，方便我们复制直接定位到该标题的超链接。\nlink-external-icon：设置为true时会在外部链接上显示一个小图标。\nlink-external-newwindow：是否在新标签页打开外部链接。\ndf-print：表格输出样式\n\ncode-copy：设置代码复制按钮：\n\ntrue: 总是在代码块右上角显示代码复制按钮。\nfalse: 隐藏代码复制按钮。\nhover：（默认）当鼠标移过时显示代码复制按钮。\n\n\ncode-fold: 是否折叠代码。\ncode-link: 是否自动为函数加上超链接。该功能基于downlit包，可以自动为识别到的函数加上一个链接到官方文档的超链接。",
    "crumbs": [
      "Home",
      "Quarto introduction",
      "YAML设置"
    ]
  },
  {
    "objectID": "Quarto/yaml_settings.html#sec-github-markdown",
    "href": "Quarto/yaml_settings.html#sec-github-markdown",
    "title": "YAML设置",
    "section": "\n10.2 编译GitHub Flavored Markdown（GFM）",
    "text": "10.2 编译GitHub Flavored Markdown（GFM）\n我们可以将Quarto文档转换为GitHub风格的Markdown文档（GitHub Flavored Markdown，GFM）。这可以用来生成GitHub项目的README.md文档。\n\n---\ntitle: \"My Project\"\nformat: \n  gfm:\n    identifier-prefix: readme # 标识符\n    # preview-mode: raw # 预览原始markdown\n    keep-yaml: true\n    toc: true\n    toc-depth: 1\n    number-sections: true\n    citation-location: document\n    output-file: \"README.md\" # 输出文档的文件名\n---",
    "crumbs": [
      "Home",
      "Quarto introduction",
      "YAML设置"
    ]
  },
  {
    "objectID": "Quarto/yaml_settings.html#编译pdf",
    "href": "Quarto/yaml_settings.html#编译pdf",
    "title": "YAML设置",
    "section": "\n10.3 编译PDF",
    "text": "10.3 编译PDF\n如果要在rmarkdown、bookdown中使用PDF输出功能， 可以在在R中安装tinytex扩展包并安装TinyTeX编译软件：\n\ninstall.packages('tinytex')\ntinytex::install_tinytex()\n\n其中上面第一行命令安装R的tinytex扩展包， 第二行将下载LaTeX编译程序的服务器设置为清华大学tuna镜像站， 第三行安装LaTeX编译程序。\n如果安装成功， TinyTeX软件包在MS Windows系统中一般会安装在 C:\\Users\\用户名\\AppData\\Roaming\\TinyTeX目录中， 其中”用户名”应替换成系统当前用户名。 如果需要删除TinyTeX软件包， 只要直接删除那个子目录就可以。\n为了判断TinyTeX是否安装成功， 在RStudio中运行：\n\ntinytex::is_tinytex()\n\n结果应为TRUE, 出错或者结果为FALSE都说明安装不成功。\n当用户使用RMarkdown和tinytex包转换latex并编译为PDF时， 如果缺少某些latex宏包， tinytex会自动安装缺少的宏包。",
    "crumbs": [
      "Home",
      "Quarto introduction",
      "YAML设置"
    ]
  },
  {
    "objectID": "Guide/SAS/SAS-intro.html",
    "href": "Guide/SAS/SAS-intro.html",
    "title": "SAS introduction",
    "section": "",
    "text": "SAS introduction",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "SAS introduction"
    ]
  },
  {
    "objectID": "Guide/R/R-intro.html",
    "href": "Guide/R/R-intro.html",
    "title": "R introduction",
    "section": "",
    "text": "R的介绍",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "R introduction"
    ]
  },
  {
    "objectID": "Guide/Guide-intro.html",
    "href": "Guide/Guide-intro.html",
    "title": "统计软件使用指南",
    "section": "",
    "text": "一些统计软件的使用",
    "crumbs": [
      "Home",
      "统计软件使用指南"
    ]
  },
  {
    "objectID": "Guide/R/R-install.html",
    "href": "Guide/R/R-install.html",
    "title": "MacOS",
    "section": "",
    "text": "进入官网：https://www.r-project.org/\n找到适合操作系统的安装包与合适的版本\n\n点击download R\n找个离你近的学校或者随便哪个都行\n根据电脑选择一下安装包\nmacOS需要看一下是Intel还是arm的CPU，arm目前在M1/M2上搭载\n下载到download中\n在download中查看，选中R-4.3.2-x86_64.pkg这个文件，右键后选择第一个option“open”\n\n进入安装界面\n\n然后一直continue\n出现上面页面后，点击install后需要输入电脑密码，解锁后安装\n安装完成后可以选择保留安装包或者将其移入trash（废纸篓）\n安装完成后在Launchpad中找到R，双击进入操作界面\n进入后发现系统有点缺陷，因为是新电脑，有很多不完善的地方，找了一些办法解决\nDuring startup - Warning messages:  \n1: Setting LC_CTYPE failed, using \"C\"   \n2: Setting LC_COLLATE failed, using \"C\"   \n3: Setting LC_TIME failed, using \"C\"   \n4: Setting LC_MESSAGES failed, using \"C\"   \n5: Setting LC_MONETARY failed, using \"C\"   \n[R.app GUI 1.80 (8281) x86_64-apple-darwin20]    \nWARNING: You're using a non-UTF8 locale, therefore only ASCII characters will work. Please read R for Mac OS X FAQ (see Help) section 9 and adjust your system preferences accordingly.\n以上是warning，解决办法是\n⌘+space(空格键）调出Spotlight Search，然后输入terminal再点击open，打开后输入locale查看本地的设置，得到如下\n{bash,eval = FALSE} LANG=\"\" LC_COLLATE=\"C\" LC_CTYPE=\"UTF-8\" LC_MESSAGES=\"C\" LC_MONETARY=\"C\" LC_NUMERIC=\"C\" LC_TIME=\"C\" LC_ALL=\n这些还没有配置好，进行一些配置：\n{bash，eval = FALSE}        export LC_CTYPE=en_US.UTF-8 export LC_COLLATE=en_US.UTF-8 export LC_TIME=en_US.UTF-8 export LC_MESSAGES=en_US.UTF-8 export LC_MONETARY=en_US.UTF-8\n这样就可以了。\n然后再安装Rstudio，RStudio是为R语言设计的一种跨平台集成开发环境。其特色包括可客制化的软件套件视觉化界面与同团队开发的一系列数据可视化与出版工具。\n在Rstudio中下载合适的版本，按照上述操作再来亿遍即可。",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "R introduction",
      "MacOS"
    ]
  },
  {
    "objectID": "Guide/SAS/SAS-install.html",
    "href": "Guide/SAS/SAS-install.html",
    "title": "SAS Install",
    "section": "",
    "text": "SAS Install",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "SAS introduction",
      "SAS Install"
    ]
  },
  {
    "objectID": "Quarto/quarto-intro.html",
    "href": "Quarto/quarto-intro.html",
    "title": "Quarto introduction",
    "section": "",
    "text": "Quarto introduction",
    "crumbs": [
      "Home",
      "Quarto introduction"
    ]
  },
  {
    "objectID": "statistics-basic/statistics-basic.html",
    "href": "statistics-basic/statistics-basic.html",
    "title": "医学统计学基础",
    "section": "",
    "text": "本章主要介绍基本的医学统计学内容，主要参照内容为：人卫第八版《卫生统计学》、科社第二版《医学统计学（基础版）》。\n\n章节主要分布如下：\n\n绪论\n\n医学统计学\n统计学的基本概念\n统计学在医学科研中的基本步骤\n统计学与相关学科的关系\n\n描述性统计\n随机事件与概率\n离散型随机变量\n连续型随机变量\n参数估计\n一个正态总体参数的假设检验\n两个正态总体参数的假设检验\n单因素方差分析\n多因素方差分析\n\\(\\chi^2\\)检验\n基于秩次的非参数检验\n一元线性回归\n相关分析",
    "crumbs": [
      "Home",
      "医学统计学基础"
    ]
  },
  {
    "objectID": "solana/index.html",
    "href": "solana/index.html",
    "title": "Sigríður Björndotter",
    "section": "",
    "text": "Sigríður Björndotter is a musician, vocalist, and live entertainment consultant living in Buenos Aires, Argentina. Her writing has appeared in Rolling Stone, Billboard, and NME, and she is a frequent contributor to National Public Radio’s All Songs Considered. She has been raising Pembroke Welsh Corgis since the age of six, and she has collected Casio watches since the age of ten."
  },
  {
    "objectID": "solana/index.html#bio",
    "href": "solana/index.html#bio",
    "title": "Sigríður Björndotter",
    "section": "",
    "text": "Sigríður Björndotter is a musician, vocalist, and live entertainment consultant living in Buenos Aires, Argentina. Her writing has appeared in Rolling Stone, Billboard, and NME, and she is a frequent contributor to National Public Radio’s All Songs Considered. She has been raising Pembroke Welsh Corgis since the age of six, and she has collected Casio watches since the age of ten."
  },
  {
    "objectID": "solana/index.html#education",
    "href": "solana/index.html#education",
    "title": "Sigríður Björndotter",
    "section": "\n2 Education",
    "text": "2 Education\nINSEAD | Fontainebleau, France\nM.B.A. | August 2014 - June 2015\nThe Juilliard School | New York, NY\nB.F.A. in Music Performance | August 2005 - May 2009"
  },
  {
    "objectID": "solana/index.html#experience",
    "href": "solana/index.html#experience",
    "title": "Sigríður Björndotter",
    "section": "\n3 Experience",
    "text": "3 Experience\nFreelance | Live Entertainment Consultant | August 2018 - Present\nCercle | Producer | August 2018 - Present\nNational Public Radio | Producer | May 2015 - July 2018\nNME Magazine | Editor | July 2014 - July 2016\nIceland Symphony Orchestra | Cellist | October 2009 - June 2014"
  },
  {
    "objectID": "statistics-basic/01-preview.html",
    "href": "statistics-basic/01-preview.html",
    "title": "Preview",
    "section": "",
    "text": "卫生统计学是一门致力于收集、分析和解释与健康相关的数据的学科。它的目标是通过统计方法来评估和改善人群的健康状况，从而提高公共卫生水平。卫生统计学将统计学原理应用于医学和公共卫生领域，以支持健康决策的制定和实施。\n\n\n\n卫生统计学在以下几个方面发挥着重要作用：\n\n疾病监测与控制： 通过收集和分析疾病发病率、死亡率和流行病学数据，卫生统计学帮助识别疾病的流行趋势，并制定相应的预防和控制策略。\n健康政策制定： 卫生统计学提供了评估不同健康政策和干预措施效果的方法，为政策制定者提供了决策支持。\n卫生服务评估： 通过分析卫生服务的覆盖范围、质量和效率，卫生统计学评估卫生系统的运作情况，并提供改进建议。\n流行病学研究： 卫生统计学在研究人群健康与疾病之间的关系方面发挥着关键作用，帮助揭示疾病的发病机制和影响因素。\n\n\n\n\n随着数据科学和人工智能技术的发展，卫生统计学将迎来新的机遇和挑战：\n\n大数据与人工智能： 大数据技术使得收集、整合和分析海量的健康数据成为可能，而人工智能技术则提供了更高效、精确的数据处理和预测能力，为卫生统计学研究提供了新的方法和工具。\n个性化医疗： 基于个体遗传信息和生活方式数据的个性化医疗将成为未来的发展趋势，卫生统计学将在个体化医疗决策和健康管理中发挥更加重要的作用。\n跨学科合作： 卫生统计学将与流行病学、遗传学、生物信息学等学科交叉融合，形成跨学科合作的新模式，共同解决健康领域的复杂问题。\n公众参与与健康促进： 卫生统计学将更加注重公众参与和社区健康促进，通过社会行为和环境因素的分析，促进健康政策的制定和实施，推动社会健康公平。\n\n随着社会的发展和健康需求的不断变化，卫生统计学将继续发挥着重要的作用，为促进全民健康、预防疾病、改善医疗服务质量和推动卫生政策提供支持和指导。"
  },
  {
    "objectID": "statistics-basic/01-preview.html#什么是卫生统计学",
    "href": "statistics-basic/01-preview.html#什么是卫生统计学",
    "title": "Preview",
    "section": "",
    "text": "卫生统计学是一门致力于收集、分析和解释与健康相关的数据的学科。它的目标是通过统计方法来评估和改善人群的健康状况，从而提高公共卫生水平。卫生统计学将统计学原理应用于医学和公共卫生领域，以支持健康决策的制定和实施。"
  },
  {
    "objectID": "statistics-basic/01-preview.html#卫生统计学的重要性",
    "href": "statistics-basic/01-preview.html#卫生统计学的重要性",
    "title": "Preview",
    "section": "",
    "text": "卫生统计学在以下几个方面发挥着重要作用：\n\n疾病监测与控制： 通过收集和分析疾病发病率、死亡率和流行病学数据，卫生统计学帮助识别疾病的流行趋势，并制定相应的预防和控制策略。\n健康政策制定： 卫生统计学提供了评估不同健康政策和干预措施效果的方法，为政策制定者提供了决策支持。\n卫生服务评估： 通过分析卫生服务的覆盖范围、质量和效率，卫生统计学评估卫生系统的运作情况，并提供改进建议。\n流行病学研究： 卫生统计学在研究人群健康与疾病之间的关系方面发挥着关键作用，帮助揭示疾病的发病机制和影响因素。"
  },
  {
    "objectID": "statistics-basic/01-preview.html#卫生统计学的未来展望",
    "href": "statistics-basic/01-preview.html#卫生统计学的未来展望",
    "title": "Preview",
    "section": "",
    "text": "随着数据科学和人工智能技术的发展，卫生统计学将迎来新的机遇和挑战：\n\n大数据与人工智能： 大数据技术使得收集、整合和分析海量的健康数据成为可能，而人工智能技术则提供了更高效、精确的数据处理和预测能力，为卫生统计学研究提供了新的方法和工具。\n个性化医疗： 基于个体遗传信息和生活方式数据的个性化医疗将成为未来的发展趋势，卫生统计学将在个体化医疗决策和健康管理中发挥更加重要的作用。\n跨学科合作： 卫生统计学将与流行病学、遗传学、生物信息学等学科交叉融合，形成跨学科合作的新模式，共同解决健康领域的复杂问题。\n公众参与与健康促进： 卫生统计学将更加注重公众参与和社区健康促进，通过社会行为和环境因素的分析，促进健康政策的制定和实施，推动社会健康公平。\n\n随着社会的发展和健康需求的不断变化，卫生统计学将继续发挥着重要的作用，为促进全民健康、预防疾病、改善医疗服务质量和推动卫生政策提供支持和指导。"
  },
  {
    "objectID": "Learn/Basic/test.html",
    "href": "Learn/Basic/test.html",
    "title": "初识医学统计学",
    "section": "",
    "text": "rmarkdown",
    "crumbs": [
      "Home",
      "医学统计学基础",
      "医学统计学基础",
      "初识医学统计学"
    ]
  },
  {
    "objectID": "Learn/Basic/01-preview.html",
    "href": "Learn/Basic/01-preview.html",
    "title": "Preview",
    "section": "",
    "text": "卫生统计学是一门致力于收集、分析和解释与健康相关的数据的学科。它的目标是通过统计方法来评估和改善人群的健康状况，从而提高公共卫生水平。卫生统计学将统计学原理应用于医学和公共卫生领域，以支持健康决策的制定和实施。\n\n\n\n卫生统计学在以下几个方面发挥着重要作用：\n\n疾病监测与控制： 通过收集和分析疾病发病率、死亡率和流行病学数据，卫生统计学帮助识别疾病的流行趋势，并制定相应的预防和控制策略。\n健康政策制定： 卫生统计学提供了评估不同健康政策和干预措施效果的方法，为政策制定者提供了决策支持。\n卫生服务评估： 通过分析卫生服务的覆盖范围、质量和效率，卫生统计学评估卫生系统的运作情况，并提供改进建议。\n流行病学研究： 卫生统计学在研究人群健康与疾病之间的关系方面发挥着关键作用，帮助揭示疾病的发病机制和影响因素。\n\n\n\n\n随着数据科学和人工智能技术的发展，卫生统计学将迎来新的机遇和挑战：\n\n大数据与人工智能： 大数据技术使得收集、整合和分析海量的健康数据成为可能，而人工智能技术则提供了更高效、精确的数据处理和预测能力，为卫生统计学研究提供了新的方法和工具。\n个性化医疗： 基于个体遗传信息和生活方式数据的个性化医疗将成为未来的发展趋势，卫生统计学将在个体化医疗决策和健康管理中发挥更加重要的作用。\n跨学科合作： 卫生统计学将与流行病学、遗传学、生物信息学等学科交叉融合，形成跨学科合作的新模式，共同解决健康领域的复杂问题。\n公众参与与健康促进： 卫生统计学将更加注重公众参与和社区健康促进，通过社会行为和环境因素的分析，促进健康政策的制定和实施，推动社会健康公平。\n\n随着社会的发展和健康需求的不断变化，卫生统计学将继续发挥着重要的作用，为促进全民健康、预防疾病、改善医疗服务质量和推动卫生政策提供支持和指导。",
    "crumbs": [
      "Home",
      "医学统计学基础",
      "医学统计学基础",
      "Preview"
    ]
  },
  {
    "objectID": "Learn/Basic/01-preview.html#什么是卫生统计学",
    "href": "Learn/Basic/01-preview.html#什么是卫生统计学",
    "title": "Preview",
    "section": "",
    "text": "卫生统计学是一门致力于收集、分析和解释与健康相关的数据的学科。它的目标是通过统计方法来评估和改善人群的健康状况，从而提高公共卫生水平。卫生统计学将统计学原理应用于医学和公共卫生领域，以支持健康决策的制定和实施。",
    "crumbs": [
      "Home",
      "医学统计学基础",
      "医学统计学基础",
      "Preview"
    ]
  },
  {
    "objectID": "Learn/Basic/01-preview.html#卫生统计学的重要性",
    "href": "Learn/Basic/01-preview.html#卫生统计学的重要性",
    "title": "Preview",
    "section": "",
    "text": "卫生统计学在以下几个方面发挥着重要作用：\n\n疾病监测与控制： 通过收集和分析疾病发病率、死亡率和流行病学数据，卫生统计学帮助识别疾病的流行趋势，并制定相应的预防和控制策略。\n健康政策制定： 卫生统计学提供了评估不同健康政策和干预措施效果的方法，为政策制定者提供了决策支持。\n卫生服务评估： 通过分析卫生服务的覆盖范围、质量和效率，卫生统计学评估卫生系统的运作情况，并提供改进建议。\n流行病学研究： 卫生统计学在研究人群健康与疾病之间的关系方面发挥着关键作用，帮助揭示疾病的发病机制和影响因素。",
    "crumbs": [
      "Home",
      "医学统计学基础",
      "医学统计学基础",
      "Preview"
    ]
  },
  {
    "objectID": "Learn/Basic/01-preview.html#卫生统计学的未来展望",
    "href": "Learn/Basic/01-preview.html#卫生统计学的未来展望",
    "title": "Preview",
    "section": "",
    "text": "随着数据科学和人工智能技术的发展，卫生统计学将迎来新的机遇和挑战：\n\n大数据与人工智能： 大数据技术使得收集、整合和分析海量的健康数据成为可能，而人工智能技术则提供了更高效、精确的数据处理和预测能力，为卫生统计学研究提供了新的方法和工具。\n个性化医疗： 基于个体遗传信息和生活方式数据的个性化医疗将成为未来的发展趋势，卫生统计学将在个体化医疗决策和健康管理中发挥更加重要的作用。\n跨学科合作： 卫生统计学将与流行病学、遗传学、生物信息学等学科交叉融合，形成跨学科合作的新模式，共同解决健康领域的复杂问题。\n公众参与与健康促进： 卫生统计学将更加注重公众参与和社区健康促进，通过社会行为和环境因素的分析，促进健康政策的制定和实施，推动社会健康公平。\n\n随着社会的发展和健康需求的不断变化，卫生统计学将继续发挥着重要的作用，为促进全民健康、预防疾病、改善医疗服务质量和推动卫生政策提供支持和指导。",
    "crumbs": [
      "Home",
      "医学统计学基础",
      "医学统计学基础",
      "Preview"
    ]
  },
  {
    "objectID": "Learn/Basic/statistics-basic.html",
    "href": "Learn/Basic/statistics-basic.html",
    "title": "医学统计学基础",
    "section": "",
    "text": "本章主要介绍基本的医学统计学内容，主要参照内容为：人卫第八版《卫生统计学》、科社第二版《医学统计学（基础版）》。\n\n章节主要分布如下：\n\n绪论\n\n医学统计学\n统计学的基本概念\n统计学在医学科研中的基本步骤\n统计学与相关学科的关系\n\n描述性统计\n随机事件与概率\n离散型随机变量\n连续型随机变量\n参数估计\n一个正态总体参数的假设检验\n两个正态总体参数的假设检验\n单因素方差分析\n多因素方差分析\n\\(\\chi^2\\)检验\n基于秩次的非参数检验\n一元线性回归\n相关分析",
    "crumbs": [
      "Home",
      "Learn/statistics-basic/statistics-basic.qmd",
      "医学统计学基础"
    ]
  },
  {
    "objectID": "navbar/book.html",
    "href": "navbar/book.html",
    "title": "医学统计学习推荐书籍与网站",
    "section": "",
    "text": "读的书有点乱，主要都在微信读书看，部分是纸质书。\n对于刚接触统计的朋友，可以先看看《女士品茶：统计学如何变革了科学和生活》这本书，也会他能激发你的一些对于统计学（家们）的兴趣，通过一些有趣的小故事，带你走进统计学的世界。"
  },
  {
    "objectID": "Learn/Basic/00-basic.html",
    "href": "Learn/Basic/00-basic.html",
    "title": "医学统计学基础",
    "section": "",
    "text": "本章主要介绍基本的医学统计学内容，主要参照内容为：人卫第八版《卫生统计学》、科社第二版《医学统计学（基础版）》。\n\n章节主要分布如下：\n\n绪论\n\n医学统计学\n统计学的基本概念\n统计学在医学科研中的基本步骤\n统计学与相关学科的关系\n\n描述性统计\n随机事件与概率\n离散型随机变量\n连续型随机变量\n参数估计\n一个正态总体参数的假设检验\n两个正态总体参数的假设检验\n单因素方差分析\n多因素方差分析\n\\(\\chi^2\\)检验\n基于秩次的非参数检验\n一元线性回归\n相关分析",
    "crumbs": [
      "Home",
      "医学统计学基础"
    ]
  },
  {
    "objectID": "Guide/Python/2025-02-20-Medical-expenses.html",
    "href": "Guide/Python/2025-02-20-Medical-expenses.html",
    "title": "用Python处理一份卫生费用数据",
    "section": "",
    "text": "本篇博客用来记录2025年1月到2月帮助学弟处理一份某二级医院2018-2023年的医疗费用，最开始用的Stata，但是越往后，越感觉到Stata的难用，以及AI对这种程序的支持程度极其有限，随改用Python来继续完成相关的分析。\n\n\n运行此文档需要电脑上以安装Python，并且下列包已被安装并且能被调用：\nnumpy jupyter-cache pandas openpyxl\n你可以使用 pip 或 conda 进行安装： pip install jupyter-cache\n\n\n\n我们可以使用pandas包来查看部分原始数据，数据的基本样式如下：\n\n# 安装并加载必要的包\nimport pandas as pd\nimport numpy as np\n\n# 导入 Excel 文件\nfile_path = \"C:/Users/asus/Desktop/test/stata/prepare.xlsx\"\ndata = pd.read_excel(file_path, sheet_name=0, engine='openpyxl')     \n\n# 随机抽取10个样本数据\nsample_data = data.sample(n=10, random_state=42)\n\n# 打印样本数据\nprint(sample_data)\n\n      次数        出生日期 性别   年龄      医疗付费方式  国籍 新生儿出生体重 新生儿入院体重  \\\n1138   1  1956-09-06  男  61岁    新型农村合作医疗  中国       －       －   \n2024   1  1959-08-15  女  59岁  城镇居民基本医疗保险  中国       －       －   \n1605   1  1973-02-05  女  45岁    新型农村合作医疗  中国       －       －   \n1975  11  2012-09-20  男   6岁    新型农村合作医疗  中国       －       －   \n1701   1  1963-01-23  男  55岁         全自费  中国       －       －   \n218    1  1969-06-08  女  48岁    新型农村合作医疗  中国       －       －   \n1344   1  1960-09-11  女  57岁    新型农村合作医疗  中国       －       －   \n252    1  1944-05-01  女  73岁    新型农村合作医疗  中国       －       －   \n1921   5  2013-10-17  女   5岁    新型农村合作医疗  中国       －       －   \n643    1  1997-09-02  男  20岁         全自费  中国       －       －   \n\n                     出生地         籍贯  ... 麻醉开始时间3 麻醉结束时间3 麻醉方式3 麻醉分级3 切口部位3  \\\n1138           福建省莆田市秀屿区  福建省莆田市秀屿区  ...     NaN     NaN   NaN   NaN   NaN   \n2024               福建莆田市         莆田  ...     NaN     NaN   NaN   NaN   NaN   \n1605                 福建省          闽  ...     NaN     NaN   NaN   NaN   NaN   \n1975              莆田市荔城区     福建省莆田市  ...     NaN     NaN   NaN   NaN   NaN   \n1701                福建莆田       福建莆田  ...     NaN     NaN   NaN   NaN   NaN   \n218                  福建省     福建省莆田市  ...     NaN     NaN   NaN   NaN   NaN   \n1344  福建省福清市渔溪镇联华村火烧埔36号         福建  ...     NaN     NaN   NaN   NaN   NaN   \n252                福建莆田市         莆田  ...     NaN     NaN   NaN   NaN   NaN   \n1921           福建省莆田市城厢区     福建省莆田市  ...     NaN     NaN   NaN   NaN   NaN   \n643                 北京通县       北京通县  ...     NaN     NaN   NaN   NaN   NaN   \n\n     切口等级3  NNIS分级3 手术部位感染3 术前住院天数3  手术持续时间3  \n1138   NaN      NaN     NaN     NaN      NaN  \n2024   NaN      NaN     NaN     NaN      NaN  \n1605   NaN      NaN     NaN     NaN      NaN  \n1975   NaN      NaN     NaN     NaN      NaN  \n1701   NaN      NaN     NaN     NaN      NaN  \n218    NaN      NaN     NaN     NaN      NaN  \n1344   NaN      NaN     NaN     NaN      NaN  \n252    NaN      NaN     NaN     NaN      NaN  \n1921   NaN      NaN     NaN     NaN      NaN  \n643    NaN      NaN     NaN     NaN      NaN  \n\n[10 rows x 202 columns]\n\n\n我们可以看到，该数据的列很多，第一张表中有220列，我们需要对其进行一些筛选。\n\n\n\n从哪里开始是一个需要思考的问题，对于数据的认识决定了你处理问题的方向和效率。首先，理解数据的来源至关重要，这包括了解数据是如何收集的、收集过程中可能出现的偏差或错误。其次，明确数据的类型与结构也是关键步骤之一，不同类型的数据（如定量数据、定性数据）需要采用不同的分析方法。再者，对数据进行初步探索，比如通过可视化手段观察数据分布特征，或是计算一些基本统计量来了解数据的基本情况，能够帮助你更好地制定数据处理策略。\n在真正开始处理数据之前，还需要考虑你的目标是什么。是为了回答一个具体的问题，还是为了探索潜在的模式？明确了目标之后，才能有针对性地选择合适的工具和技术。此外，考虑到数据质量的问题，数据清洗是不可跳过的一步，它包括去除异常值、填补缺失值等操作，这对于提高分析结果的准确性非常关键。\n最后，保持对数据伦理的关注同样重要，在整个数据分析的过程中，确保遵循相关的隐私保护法规和道德标准，这样才能确保你的工作不仅有效，而且负责任。通过对数据全面而深刻的理解，你可以更加自信地从数据中提取有价值的信息，并为决策提供有力支持。\n\n\n这份Excel文件有6张sheet，分别是2018-2023年，首先需要检查这六张sheet中的变量是否一致：\n\nimport pandas as pd\n\n# 导入 Excel 文件\nfile_path = \"C:/Users/asus/Desktop/test/stata/prepare.xlsx\"\nsheet_names = [\"2018\", \"2019\", \"2020\", \"2021\", \"2022\", \"2023\"]\n\n# 读取所有 sheet 的数据\nsheets_data = {sheet: pd.read_excel(file_path, sheet_name=sheet) for sheet in sheet_names}\n\n# 获取每个 sheet 的列名\nsheets_columns = {sheet: set(data.columns) for sheet, data in sheets_data.items()}\n\n# 找出所有 sheet 的共同变量和不一致的变量\ncommon_columns = set.intersection(*sheets_columns.values())\nall_columns = set.union(*sheets_columns.values())\ninconsistent_columns = all_columns - common_columns\n\n# 打印结果\nprint(\"一致的变量名:\")\nprint(common_columns)\n\nprint(\"\\n不一致的变量名:\")\nprint(inconsistent_columns)\n\n# 打印每个 sheet 的变量\nfor sheet, columns in sheets_columns.items():\n    print(f\"\\n{sheet} 的变量: {columns}\")\n\n一致的变量名:\n{'NNIS分级2', '手术操作名称2', '出院诊断', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '是否非计划重返手术室病例2', '切口部位1', '9.3手术用一次性医用材料费', '8.3球蛋白类制品费', '入院诊断', '术前预防性抗菌药物给药时间1', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '3.5手术费', '切口部位2', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '择期手术1', '4手术时间', '病案质量', '麻醉方式2', '腔镜手术名称2', '6手术时间', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '是否有出院31天内再住院计划', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '级别1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '手术结束时间2', '婚姻', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '离院方式', '8.5细胞因子类制品费', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '药占比%'}\n\n不一致的变量名:\n{'择期手术3', '7麻醉方式', '7愈合', '4麻醉医师', 'NNIS分级3', '7手术时间', '手术次数3', '切口等级3', '7切口', '手术开始时间3', '8手术编码', '7手术名称', '麻醉开始时间3', '8切口', '8级别', '术前住院天数3', '8手术时间', '8手术名称', '手术结束时间3', '手术操作编码3', '麻醉方式3', '手术操作名称3', '8麻醉方式', '手术持续时间3', '7手术编码', '愈合2', '8愈合', '7级别', '手术部位感染3', '麻醉结束时间3', '切口部位3', '是否微创手术2', '4麻醉方式', '麻醉分级3'}\n\n2018 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '术前预防性抗菌药物给药时间1', '手术开始时间3', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '3.5手术费', '切口部位2', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '手术操作名称3', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术持续时间3', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '4麻醉方式', '择期手术3', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '切口等级3', '6手术时间', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '麻醉开始时间3', '3手术名称', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '手术结束时间3', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '麻醉方式3', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '手术次数3', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '级别1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '手术结束时间2', '婚姻', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '麻醉分级3', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', 'NNIS分级3', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '术前住院天数3', '3手术编码', '麻醉分级2', '新生儿出生体重', '离院方式', '8.5细胞因子类制品费', '手术操作编码3', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '愈合2', '8.4凝血因子类制品费', '职业', '手术部位感染3', '2.1病理诊断费', '麻醉结束时间3', '5.中医治疗费', '年龄', '切口部位3', '是否药物过敏', '是否有出院31天内再住院计划', '是否微创手术2'}\n\n2019 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '7愈合', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '术前预防性抗菌药物给药时间1', '手术开始时间3', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '3.5手术费', '切口部位2', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '手术操作名称3', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '4麻醉方式', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '6手术时间', '7切口', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '手术结束时间3', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '7麻醉方式', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '手术次数3', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '7手术编码', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '级别1', '手术结束时间2', '婚姻', '7级别', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '7手术时间', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '7手术名称', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '离院方式', '8.5细胞因子类制品费', '手术操作编码3', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '愈合2', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '是否有出院31天内再住院计划', '是否微创手术2'}\n\n2020 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '7愈合', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '8手术编码', '术前预防性抗菌药物给药时间1', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '8切口', '3.5手术费', '切口部位2', '8手术时间', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '4麻醉方式', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '6手术时间', '7切口', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '8级别', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '7麻醉方式', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '8麻醉方式', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '7手术编码', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '级别1', '手术结束时间2', '8愈合', '婚姻', '7级别', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '7手术时间', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '7手术名称', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '8手术名称', '离院方式', '8.5细胞因子类制品费', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '是否有出院31天内再住院计划'}\n\n2021 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '7愈合', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '8手术编码', '术前预防性抗菌药物给药时间1', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '8切口', '3.5手术费', '切口部位2', '8手术时间', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '4麻醉方式', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '6手术时间', '7切口', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '8级别', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '7麻醉方式', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '8麻醉方式', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '7手术编码', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '级别1', '手术结束时间2', '8愈合', '婚姻', '7级别', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '7手术时间', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '7手术名称', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '8手术名称', '离院方式', '8.5细胞因子类制品费', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '是否有出院31天内再住院计划'}\n\n2022 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '7愈合', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '8手术编码', '术前预防性抗菌药物给药时间1', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '8切口', '3.5手术费', '切口部位2', '8手术时间', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '4麻醉方式', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '6手术时间', '7切口', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '8级别', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '7麻醉方式', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '8麻醉方式', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '7手术编码', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '级别1', '手术结束时间2', '8愈合', '婚姻', '7级别', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '7手术时间', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '7手术名称', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '8手术名称', '离院方式', '8.5细胞因子类制品费', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '是否有出院31天内再住院计划'}\n\n2023 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '7愈合', '4麻醉医师', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '8手术编码', '术前预防性抗菌药物给药时间1', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '8切口', '3.5手术费', '切口部位2', '8手术时间', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '6手术时间', '7切口', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '8级别', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '7麻醉方式', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '8麻醉方式', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '7手术编码', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '级别1', '手术结束时间2', '8愈合', '婚姻', '7级别', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '7手术时间', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '7手术名称', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '8手术名称', '离院方式', '8.5细胞因子类制品费', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '是否有出院31天内再住院计划'}\n\n\n然后剔除不一致的变量数据，同时创建一个新变量year，用sheet的年份对其进行填充，再按变量名对应合并6张表格的数据称为一张总表，命名为merge-sheet.xlsx输出到你需要存放数据的文件夹中。\n变量还是太多了，那接下来对变量进行筛选，首先我们可以对所有键值为空的变量进行剔除，或者根据实际的研究需要，剔除一部分键值全部为null的变量。\n这里我选择对键值全部为null或0的变量进行剔除。\n第一次尝试的时候，打开表后进行查看，发现变量顺序很乱，没有按照原始顺序进行排列，处理办法则是在前面的变量筛选部分使用DataFrame的loc方法选择列，同时保持列的顺序。\n同时为了节省时间，因为在Quarto中运行Python代码很慢，暂时还不知道原因，待以后调试一下。所以最后用一个程序解决上述这些问题，节省时间。\n\nimport pandas as pd\n\n# 导入 Excel 文件\nfile_path = \"C:/Users/asus/Desktop/test/stata/prepare.xlsx\"\noutput_path = \"C:/Users/asus/Desktop/test/stata/data/merge-data.xlsx\"\nfinal_output_path = \"C:/Users/asus/Desktop/test/stata/data/cleaned-merge-data.xlsx\"\nsheet_names = [\"2018\", \"2019\", \"2020\", \"2021\", \"2022\", \"2023\"]\n\n# 读取所有 sheet 的数据\nsheets_data = {sheet: pd.read_excel(file_path, sheet_name=sheet) for sheet in sheet_names}\n\n# 获取每个 sheet 的列名\nsheets_columns = {sheet: set(data.columns) for sheet, data in sheets_data.items()}\n\n# 找出所有 sheet 的共同变量\ncommon_columns = set.intersection(*sheets_columns.values())\n# 保持原始顺序\ncommon_columns = list(common_columns)  \n\n# 剔除不一致的变量数据，并添加 year 变量\nfor sheet, data in sheets_data.items():\n    sheets_data[sheet] = data[list(common_columns)]\n    sheets_data[sheet]['year'] = sheet\n\n# 合并所有 sheet 的数据\nmerged_data = pd.concat(sheets_data.values(), ignore_index=True)\n\n# 输出合并后的数据到指定路径\nmerged_data.to_excel(output_path, index=False)\n\n# 重新导入合并后的数据\nmerged_data = pd.read_excel(output_path)\n\n# 剔除键值全部为 null 或 0 的变量，同时保持原始变量的顺序\nnon_null_columns = merged_data.dropna(axis=1, how='all').columns\nnon_zero_columns = merged_data.loc[:, (merged_data != 0).any(axis=0)].columns\nvalid_columns = [col for col in merged_data.columns if col in non_null_columns and col in non_zero_columns]\n\ncleaned_data = merged_data.loc[:, valid_columns]\n\n# 输出清理后的数据到指定路径\ncleaned_data.to_excel(final_output_path, index=False)\n\nprint(f\"清理后的数据已输出到 {final_output_path}\")\n\n# 展示部分数据\n\n# 随机抽取10个样本数据\nsample_data = cleaned_data.sample(n=10)\n\n# 打印样本数据\nprint(sample_data)\n\n清理后的数据已输出到 C:/Users/asus/Desktop/test/stata/data/cleaned-merge-data.xlsx\n      NNIS分级2          手术操作名称2  \\\n14033     NaN              NaN   \n8455      NaN              NaN   \n26016     NaN              NaN   \n11010     NaN              NaN   \n31721     NaN              NaN   \n48837      0级  白内障摘除伴人工晶体一期置入术   \n31786     NaN              NaN   \n35260     NaN              NaN   \n9815      NaN              NaN   \n16671     NaN              NaN   \n\n                                                    出院诊断  2.3影像学诊断费  \\\n14033  老年性白内障|H25.900|有,玻璃体混浊|H43.300|有,眼底出血|H35.602|...         32   \n8455   特指手术后状态|Z98.800|有,并指[趾]畸形|Q70.900|有,特指手术后状态|Z9...         96   \n26016  尘肺|J64.x00x001|有,肺部感染|J98.414|有,胸腔积液|J94.804|有...          0   \n11010  颈椎间盘突出|M50.201|有,颈椎退行性病变|M48.901|有,高血压病|I10.x0...          0   \n31721  子宫内膜息肉|N84.001|有,女性盆腔炎性疾病|N73.900|有,宫颈息肉|N84.1...          0   \n48837                                  老年核性白内障|H25.100|有         36   \n31786  多处挫伤|T00.901|有,多发性脑梗死|I63.905|有,支气管扩张伴感染|J47.x...          0   \n35260  多发性结肠息肉|K63.504|临床未确定,直肠息肉|K62.100|临床未确定,慢性萎缩性...          0   \n9815   多发性结肠息肉|K63.504|有,慢性结肠炎|K52.910|有,甲状腺结节|E04.101|有          0   \n16671  腰椎间盘突出|M51.202|有,腰椎退行性病变|M48.903|有,原发性单侧膝关节病|M...          0   \n\n      是否有使用抗菌药物2 NNIS分级1 输液反应  4级别 是否非计划重返手术室病例2 切口部位1  ... 8.1血费  3愈合  \\\n14033        NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   \n8455         NaN     NaN  NaN  NaN           NaN   NaN  ...  32.2  NaN   \n26016        NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   \n11010        NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   \n31721        NaN     NaN  NaN  1.0           NaN   NaN  ...  34.0   其他   \n48837          无      0级    无  NaN             否    左眼  ...   0.0  NaN   \n31786        NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   \n35260        NaN     NaN  NaN  1.0           NaN   NaN  ...   0.0    甲   \n9815         NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   \n16671        NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   \n\n             2手术编码 6手术编码              手术开始时间1    职业   年龄 是否药物过敏  药占比%  year  \n14033          NaN   NaN                  NaN    农民  66岁      无    2%  2020  \n8455           NaN   NaN                  NaN    工人  47岁      无   14%  2019  \n26016          NaN   NaN                  NaN  退休人员  67岁      无   24%  2021  \n11010          NaN   NaN                  NaN    职员  66岁      无    0%  2019  \n31721  68.1200x001   NaN                  NaN    农民  34岁      无   12%  2021  \n48837  13.7100x001   NaN  2023-12-29 17:50:40    农民  72岁      无    1%  2023  \n31786          NaN   NaN                  NaN    其他  74岁      无   40%  2021  \n35260  45.4300x013   NaN                  NaN    其他  62岁      无    6%  2022  \n9815           NaN   NaN                  NaN  城乡居民  32岁      无    4%  2019  \n16671          NaN   NaN                  NaN    居民  62岁      无    0%  2020  \n\n[10 rows x 160 columns]",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "Python introduction",
      "用Python处理一份卫生费用数据"
    ]
  },
  {
    "objectID": "Guide/Python/2025-02-20-Medical-expenses.html#必须配置",
    "href": "Guide/Python/2025-02-20-Medical-expenses.html#必须配置",
    "title": "用Python处理一份卫生费用数据",
    "section": "",
    "text": "运行此文档需要电脑上以安装Python，并且下列包已被安装并且能被调用：\nnumpy jupyter-cache pandas openpyxl\n你可以使用 pip 或 conda 进行安装： pip install jupyter-cache",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "Python introduction",
      "用Python处理一份卫生费用数据"
    ]
  },
  {
    "objectID": "Guide/Python/2025-02-20-Medical-expenses.html#初步认识数据",
    "href": "Guide/Python/2025-02-20-Medical-expenses.html#初步认识数据",
    "title": "用Python处理一份卫生费用数据",
    "section": "",
    "text": "我们可以使用pandas包来查看部分原始数据，数据的基本样式如下：\n\n# 安装并加载必要的包\nimport pandas as pd\nimport numpy as np\n\n# 导入 Excel 文件\nfile_path = \"C:/Users/asus/Desktop/test/stata/prepare.xlsx\"\ndata = pd.read_excel(file_path, sheet_name=0, engine='openpyxl')     \n\n# 随机抽取10个样本数据\nsample_data = data.sample(n=10, random_state=42)\n\n# 打印样本数据\nprint(sample_data)\n\n      次数        出生日期 性别   年龄      医疗付费方式  国籍 新生儿出生体重 新生儿入院体重  \\\n1138   1  1956-09-06  男  61岁    新型农村合作医疗  中国       －       －   \n2024   1  1959-08-15  女  59岁  城镇居民基本医疗保险  中国       －       －   \n1605   1  1973-02-05  女  45岁    新型农村合作医疗  中国       －       －   \n1975  11  2012-09-20  男   6岁    新型农村合作医疗  中国       －       －   \n1701   1  1963-01-23  男  55岁         全自费  中国       －       －   \n218    1  1969-06-08  女  48岁    新型农村合作医疗  中国       －       －   \n1344   1  1960-09-11  女  57岁    新型农村合作医疗  中国       －       －   \n252    1  1944-05-01  女  73岁    新型农村合作医疗  中国       －       －   \n1921   5  2013-10-17  女   5岁    新型农村合作医疗  中国       －       －   \n643    1  1997-09-02  男  20岁         全自费  中国       －       －   \n\n                     出生地         籍贯  ... 麻醉开始时间3 麻醉结束时间3 麻醉方式3 麻醉分级3 切口部位3  \\\n1138           福建省莆田市秀屿区  福建省莆田市秀屿区  ...     NaN     NaN   NaN   NaN   NaN   \n2024               福建莆田市         莆田  ...     NaN     NaN   NaN   NaN   NaN   \n1605                 福建省          闽  ...     NaN     NaN   NaN   NaN   NaN   \n1975              莆田市荔城区     福建省莆田市  ...     NaN     NaN   NaN   NaN   NaN   \n1701                福建莆田       福建莆田  ...     NaN     NaN   NaN   NaN   NaN   \n218                  福建省     福建省莆田市  ...     NaN     NaN   NaN   NaN   NaN   \n1344  福建省福清市渔溪镇联华村火烧埔36号         福建  ...     NaN     NaN   NaN   NaN   NaN   \n252                福建莆田市         莆田  ...     NaN     NaN   NaN   NaN   NaN   \n1921           福建省莆田市城厢区     福建省莆田市  ...     NaN     NaN   NaN   NaN   NaN   \n643                 北京通县       北京通县  ...     NaN     NaN   NaN   NaN   NaN   \n\n     切口等级3  NNIS分级3 手术部位感染3 术前住院天数3  手术持续时间3  \n1138   NaN      NaN     NaN     NaN      NaN  \n2024   NaN      NaN     NaN     NaN      NaN  \n1605   NaN      NaN     NaN     NaN      NaN  \n1975   NaN      NaN     NaN     NaN      NaN  \n1701   NaN      NaN     NaN     NaN      NaN  \n218    NaN      NaN     NaN     NaN      NaN  \n1344   NaN      NaN     NaN     NaN      NaN  \n252    NaN      NaN     NaN     NaN      NaN  \n1921   NaN      NaN     NaN     NaN      NaN  \n643    NaN      NaN     NaN     NaN      NaN  \n\n[10 rows x 202 columns]\n\n\n我们可以看到，该数据的列很多，第一张表中有220列，我们需要对其进行一些筛选。",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "Python introduction",
      "用Python处理一份卫生费用数据"
    ]
  },
  {
    "objectID": "Guide/Python/2025-02-20-Medical-expenses.html#对数据的思考",
    "href": "Guide/Python/2025-02-20-Medical-expenses.html#对数据的思考",
    "title": "用Python处理一份卫生费用数据",
    "section": "",
    "text": "从哪里开始是一个需要思考的问题，对于数据的认识决定了你处理问题的方向和效率。首先，理解数据的来源至关重要，这包括了解数据是如何收集的、收集过程中可能出现的偏差或错误。其次，明确数据的类型与结构也是关键步骤之一，不同类型的数据（如定量数据、定性数据）需要采用不同的分析方法。再者，对数据进行初步探索，比如通过可视化手段观察数据分布特征，或是计算一些基本统计量来了解数据的基本情况，能够帮助你更好地制定数据处理策略。\n在真正开始处理数据之前，还需要考虑你的目标是什么。是为了回答一个具体的问题，还是为了探索潜在的模式？明确了目标之后，才能有针对性地选择合适的工具和技术。此外，考虑到数据质量的问题，数据清洗是不可跳过的一步，它包括去除异常值、填补缺失值等操作，这对于提高分析结果的准确性非常关键。\n最后，保持对数据伦理的关注同样重要，在整个数据分析的过程中，确保遵循相关的隐私保护法规和道德标准，这样才能确保你的工作不仅有效，而且负责任。通过对数据全面而深刻的理解，你可以更加自信地从数据中提取有价值的信息，并为决策提供有力支持。\n\n\n这份Excel文件有6张sheet，分别是2018-2023年，首先需要检查这六张sheet中的变量是否一致：\n\nimport pandas as pd\n\n# 导入 Excel 文件\nfile_path = \"C:/Users/asus/Desktop/test/stata/prepare.xlsx\"\nsheet_names = [\"2018\", \"2019\", \"2020\", \"2021\", \"2022\", \"2023\"]\n\n# 读取所有 sheet 的数据\nsheets_data = {sheet: pd.read_excel(file_path, sheet_name=sheet) for sheet in sheet_names}\n\n# 获取每个 sheet 的列名\nsheets_columns = {sheet: set(data.columns) for sheet, data in sheets_data.items()}\n\n# 找出所有 sheet 的共同变量和不一致的变量\ncommon_columns = set.intersection(*sheets_columns.values())\nall_columns = set.union(*sheets_columns.values())\ninconsistent_columns = all_columns - common_columns\n\n# 打印结果\nprint(\"一致的变量名:\")\nprint(common_columns)\n\nprint(\"\\n不一致的变量名:\")\nprint(inconsistent_columns)\n\n# 打印每个 sheet 的变量\nfor sheet, columns in sheets_columns.items():\n    print(f\"\\n{sheet} 的变量: {columns}\")\n\n一致的变量名:\n{'NNIS分级2', '手术操作名称2', '出院诊断', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '是否非计划重返手术室病例2', '切口部位1', '9.3手术用一次性医用材料费', '8.3球蛋白类制品费', '入院诊断', '术前预防性抗菌药物给药时间1', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '3.5手术费', '切口部位2', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '择期手术1', '4手术时间', '病案质量', '麻醉方式2', '腔镜手术名称2', '6手术时间', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '是否有出院31天内再住院计划', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '级别1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '手术结束时间2', '婚姻', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '离院方式', '8.5细胞因子类制品费', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '药占比%'}\n\n不一致的变量名:\n{'择期手术3', '7麻醉方式', '7愈合', '4麻醉医师', 'NNIS分级3', '7手术时间', '手术次数3', '切口等级3', '7切口', '手术开始时间3', '8手术编码', '7手术名称', '麻醉开始时间3', '8切口', '8级别', '术前住院天数3', '8手术时间', '8手术名称', '手术结束时间3', '手术操作编码3', '麻醉方式3', '手术操作名称3', '8麻醉方式', '手术持续时间3', '7手术编码', '愈合2', '8愈合', '7级别', '手术部位感染3', '麻醉结束时间3', '切口部位3', '是否微创手术2', '4麻醉方式', '麻醉分级3'}\n\n2018 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '术前预防性抗菌药物给药时间1', '手术开始时间3', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '3.5手术费', '切口部位2', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '手术操作名称3', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术持续时间3', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '4麻醉方式', '择期手术3', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '切口等级3', '6手术时间', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '麻醉开始时间3', '3手术名称', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '手术结束时间3', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '麻醉方式3', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '手术次数3', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '级别1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '手术结束时间2', '婚姻', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '麻醉分级3', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', 'NNIS分级3', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '术前住院天数3', '3手术编码', '麻醉分级2', '新生儿出生体重', '离院方式', '8.5细胞因子类制品费', '手术操作编码3', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '愈合2', '8.4凝血因子类制品费', '职业', '手术部位感染3', '2.1病理诊断费', '麻醉结束时间3', '5.中医治疗费', '年龄', '切口部位3', '是否药物过敏', '是否有出院31天内再住院计划', '是否微创手术2'}\n\n2019 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '7愈合', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '术前预防性抗菌药物给药时间1', '手术开始时间3', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '3.5手术费', '切口部位2', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '手术操作名称3', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '4麻醉方式', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '6手术时间', '7切口', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '手术结束时间3', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '7麻醉方式', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '手术次数3', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '7手术编码', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '级别1', '手术结束时间2', '婚姻', '7级别', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '7手术时间', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '7手术名称', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '离院方式', '8.5细胞因子类制品费', '手术操作编码3', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '愈合2', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '是否有出院31天内再住院计划', '是否微创手术2'}\n\n2020 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '7愈合', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '8手术编码', '术前预防性抗菌药物给药时间1', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '8切口', '3.5手术费', '切口部位2', '8手术时间', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '4麻醉方式', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '6手术时间', '7切口', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '8级别', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '7麻醉方式', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '8麻醉方式', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '7手术编码', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '级别1', '手术结束时间2', '8愈合', '婚姻', '7级别', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '7手术时间', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '7手术名称', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '8手术名称', '离院方式', '8.5细胞因子类制品费', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '是否有出院31天内再住院计划'}\n\n2021 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '7愈合', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '8手术编码', '术前预防性抗菌药物给药时间1', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '8切口', '3.5手术费', '切口部位2', '8手术时间', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '4麻醉方式', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '6手术时间', '7切口', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '8级别', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '7麻醉方式', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '8麻醉方式', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '7手术编码', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '级别1', '手术结束时间2', '8愈合', '婚姻', '7级别', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '7手术时间', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '7手术名称', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '8手术名称', '离院方式', '8.5细胞因子类制品费', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '是否有出院31天内再住院计划'}\n\n2022 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '7愈合', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '8手术编码', '术前预防性抗菌药物给药时间1', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '8切口', '3.5手术费', '切口部位2', '8手术时间', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '4麻醉方式', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '6手术时间', '7切口', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '8级别', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '7麻醉方式', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '8麻醉方式', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '7手术编码', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '级别1', '手术结束时间2', '8愈合', '婚姻', '7级别', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '7手术时间', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '7手术名称', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '8手术名称', '离院方式', '8.5细胞因子类制品费', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '是否有出院31天内再住院计划'}\n\n2023 的变量: {'NNIS分级2', '手术操作名称2', '出院诊断', '7愈合', '4麻醉医师', '2.3影像学诊断费', '是否有使用抗菌药物2', 'NNIS分级1', '输液反应', '4级别', '腔镜手术名称1', '入院诊断', '9.3手术用一次性医用材料费', '切口部位1', '8.3球蛋白类制品费', '是否非计划重返手术室病例2', '8手术编码', '术前预防性抗菌药物给药时间1', '4切口', '手术操作编码2', '1麻醉方式', '出院日期', '3.3手术治疗费', '清洁手术预防使用抗菌药物总天数', '手术开始时间2', '住院天数', '8切口', '3.5手术费', '切口部位2', '8手术时间', '切口等级2', '1手术时间', '细菌名称2', '出院科别', '3.2临床物理治疗费', '麻醉开始时间1', '本次住院期间有无重返手术室的计划1', '断脐后预防性使用抗菌药物给药时间2', '出生日期', '手术预防性使用抗菌药物天数1', '国籍', '术前预防性抗菌药物给药时间2', '手术预防性使用抗菌药物天数2', '5手术编码', '新生儿入院体重', '总药品费', '术前使用预防性抗菌药物2', '手术持续时间1', '病理诊断', '感染情况', '切口等级1', '术前住院天数1', '1.2一般治疗操作费', '药占比%', '4手术时间', '病案质量', '择期手术1', '麻醉方式2', '腔镜手术名称2', '6手术时间', '7切口', '5麻醉方式', '5手术名称', '输液反应次数', '断脐后预防性使用抗菌药物给药时间1', '6手术名称', '抗菌药物使用天数', '麻醉结束时间1', '6级别', '7.2中草药费', '病室.1', '入院后颅脑损伤昏迷时间', '1.1一般医疗服务费', '4愈合', '3手术名称', '8级别', '预防性抗菌药物使用时机1', '民族', '细菌名称4', '择期手术2', '术后预防性抗菌药物结束时间2', '手术操作名称1', '1手术编码', '5切口', '5愈合', '6.2抗菌药物费用', '院内感染', '4.康复费', '籍贯', '7.1中成药费', '1切口', '2手术名称', '预防性抗菌药物使用时机2', '麻醉结束时间2', '细菌名称1', '2麻醉方式', '是否有使用抗菌药物1', '手术结束时间1', '术前住院天数2', '10.其他费', '5级别', '手术操作编码1', '本次住院期间有无重返手术室的计划2', '9.2治疗用一次性医用材料费', '2.2实验室诊断费', '7麻醉方式', '1.4其他费用', '手术持续时间2', '患者入住重症监护室（ICU）情况', '2手术时间', '入院前颅脑损伤昏迷时间', '是否在术后使用预防性抗菌药物2', '1级别', '6切口', '次数', '术前使用预防性抗菌药物1', '1手术名称', '3手术时间', '性别', '输血反应', '手术部位感染1', '入院日期', '死亡患者尸检', '是否非计划重返手术室病例1', '手术次数2', '8麻醉方式', '6.1西药费', '入院途径', '血型', '8.2白蛋白类制品费', '医疗付费方式', '7手术编码', '自付金额', '细菌名称3', '是否在术后使用预防性抗菌药物1', '是否临床路径', '1.3护理费', '术后预防性抗菌药物结束时间1', '级别1', '手术结束时间2', '8愈合', '婚姻', '7级别', '血管介入治疗抗菌药物使用天数', '4手术名称', '输血反应次数', '麻醉方式1', '1愈合', '3麻醉方式', '6麻醉方式', '入院科别', '药物过敏', '2切口', '2.4临床诊断项目费', '手术次数1', '麻醉分级1', '6愈合', '7手术时间', '是否微创手术1', '级别2', '3.1非手术治疗项目费', '2愈合', '5手术时间', '病室', '2级别', '9.1检查用一次性医用材料费', '愈合1', '4手术编码', '3级别', 'RH', '7手术名称', '麻醉开始时间2', '出生地', '血管介入治疗', '总费用', '3切口', '清洁手术预防使用抗菌药物品种数', '3.4麻醉费', '手术部位感染2', '目的', '3手术编码', '麻醉分级2', '新生儿出生体重', '8手术名称', '离院方式', '8.5细胞因子类制品费', '8.1血费', '3愈合', '2手术编码', '6手术编码', '手术开始时间1', '8.4凝血因子类制品费', '职业', '2.1病理诊断费', '5.中医治疗费', '年龄', '是否药物过敏', '是否有出院31天内再住院计划'}\n\n\n然后剔除不一致的变量数据，同时创建一个新变量year，用sheet的年份对其进行填充，再按变量名对应合并6张表格的数据称为一张总表，命名为merge-sheet.xlsx输出到你需要存放数据的文件夹中。\n变量还是太多了，那接下来对变量进行筛选，首先我们可以对所有键值为空的变量进行剔除，或者根据实际的研究需要，剔除一部分键值全部为null的变量。\n这里我选择对键值全部为null或0的变量进行剔除。\n第一次尝试的时候，打开表后进行查看，发现变量顺序很乱，没有按照原始顺序进行排列，处理办法则是在前面的变量筛选部分使用DataFrame的loc方法选择列，同时保持列的顺序。\n同时为了节省时间，因为在Quarto中运行Python代码很慢，暂时还不知道原因，待以后调试一下。所以最后用一个程序解决上述这些问题，节省时间。\n\nimport pandas as pd\n\n# 导入 Excel 文件\nfile_path = \"C:/Users/asus/Desktop/test/stata/prepare.xlsx\"\noutput_path = \"C:/Users/asus/Desktop/test/stata/data/merge-data.xlsx\"\nfinal_output_path = \"C:/Users/asus/Desktop/test/stata/data/cleaned-merge-data.xlsx\"\nsheet_names = [\"2018\", \"2019\", \"2020\", \"2021\", \"2022\", \"2023\"]\n\n# 读取所有 sheet 的数据\nsheets_data = {sheet: pd.read_excel(file_path, sheet_name=sheet) for sheet in sheet_names}\n\n# 获取每个 sheet 的列名\nsheets_columns = {sheet: set(data.columns) for sheet, data in sheets_data.items()}\n\n# 找出所有 sheet 的共同变量\ncommon_columns = set.intersection(*sheets_columns.values())\n# 保持原始顺序\ncommon_columns = list(common_columns)  \n\n# 剔除不一致的变量数据，并添加 year 变量\nfor sheet, data in sheets_data.items():\n    sheets_data[sheet] = data[list(common_columns)]\n    sheets_data[sheet]['year'] = sheet\n\n# 合并所有 sheet 的数据\nmerged_data = pd.concat(sheets_data.values(), ignore_index=True)\n\n# 输出合并后的数据到指定路径\nmerged_data.to_excel(output_path, index=False)\n\n# 重新导入合并后的数据\nmerged_data = pd.read_excel(output_path)\n\n# 剔除键值全部为 null 或 0 的变量，同时保持原始变量的顺序\nnon_null_columns = merged_data.dropna(axis=1, how='all').columns\nnon_zero_columns = merged_data.loc[:, (merged_data != 0).any(axis=0)].columns\nvalid_columns = [col for col in merged_data.columns if col in non_null_columns and col in non_zero_columns]\n\ncleaned_data = merged_data.loc[:, valid_columns]\n\n# 输出清理后的数据到指定路径\ncleaned_data.to_excel(final_output_path, index=False)\n\nprint(f\"清理后的数据已输出到 {final_output_path}\")\n\n# 展示部分数据\n\n# 随机抽取10个样本数据\nsample_data = cleaned_data.sample(n=10)\n\n# 打印样本数据\nprint(sample_data)\n\n清理后的数据已输出到 C:/Users/asus/Desktop/test/stata/data/cleaned-merge-data.xlsx\n      NNIS分级2          手术操作名称2  \\\n14033     NaN              NaN   \n8455      NaN              NaN   \n26016     NaN              NaN   \n11010     NaN              NaN   \n31721     NaN              NaN   \n48837      0级  白内障摘除伴人工晶体一期置入术   \n31786     NaN              NaN   \n35260     NaN              NaN   \n9815      NaN              NaN   \n16671     NaN              NaN   \n\n                                                    出院诊断  2.3影像学诊断费  \\\n14033  老年性白内障|H25.900|有,玻璃体混浊|H43.300|有,眼底出血|H35.602|...         32   \n8455   特指手术后状态|Z98.800|有,并指[趾]畸形|Q70.900|有,特指手术后状态|Z9...         96   \n26016  尘肺|J64.x00x001|有,肺部感染|J98.414|有,胸腔积液|J94.804|有...          0   \n11010  颈椎间盘突出|M50.201|有,颈椎退行性病变|M48.901|有,高血压病|I10.x0...          0   \n31721  子宫内膜息肉|N84.001|有,女性盆腔炎性疾病|N73.900|有,宫颈息肉|N84.1...          0   \n48837                                  老年核性白内障|H25.100|有         36   \n31786  多处挫伤|T00.901|有,多发性脑梗死|I63.905|有,支气管扩张伴感染|J47.x...          0   \n35260  多发性结肠息肉|K63.504|临床未确定,直肠息肉|K62.100|临床未确定,慢性萎缩性...          0   \n9815   多发性结肠息肉|K63.504|有,慢性结肠炎|K52.910|有,甲状腺结节|E04.101|有          0   \n16671  腰椎间盘突出|M51.202|有,腰椎退行性病变|M48.903|有,原发性单侧膝关节病|M...          0   \n\n      是否有使用抗菌药物2 NNIS分级1 输液反应  4级别 是否非计划重返手术室病例2 切口部位1  ... 8.1血费  3愈合  \\\n14033        NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   \n8455         NaN     NaN  NaN  NaN           NaN   NaN  ...  32.2  NaN   \n26016        NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   \n11010        NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   \n31721        NaN     NaN  NaN  1.0           NaN   NaN  ...  34.0   其他   \n48837          无      0级    无  NaN             否    左眼  ...   0.0  NaN   \n31786        NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   \n35260        NaN     NaN  NaN  1.0           NaN   NaN  ...   0.0    甲   \n9815         NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   \n16671        NaN     NaN  NaN  NaN           NaN   NaN  ...   0.0  NaN   \n\n             2手术编码 6手术编码              手术开始时间1    职业   年龄 是否药物过敏  药占比%  year  \n14033          NaN   NaN                  NaN    农民  66岁      无    2%  2020  \n8455           NaN   NaN                  NaN    工人  47岁      无   14%  2019  \n26016          NaN   NaN                  NaN  退休人员  67岁      无   24%  2021  \n11010          NaN   NaN                  NaN    职员  66岁      无    0%  2019  \n31721  68.1200x001   NaN                  NaN    农民  34岁      无   12%  2021  \n48837  13.7100x001   NaN  2023-12-29 17:50:40    农民  72岁      无    1%  2023  \n31786          NaN   NaN                  NaN    其他  74岁      无   40%  2021  \n35260  45.4300x013   NaN                  NaN    其他  62岁      无    6%  2022  \n9815           NaN   NaN                  NaN  城乡居民  32岁      无    4%  2019  \n16671          NaN   NaN                  NaN    居民  62岁      无    0%  2020  \n\n[10 rows x 160 columns]",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "Python introduction",
      "用Python处理一份卫生费用数据"
    ]
  },
  {
    "objectID": "Guide/R/2025-02-22-CLHLS.html",
    "href": "Guide/R/2025-02-22-CLHLS.html",
    "title": "CLHLS Data Analysis by R",
    "section": "",
    "text": "这是一个使用 R 语言对 CLHLS 数据进行清洗和分析的工作文档。\n\n本文数据源来自北大开放研究数据平台。DVN/WBO7LK_2020\n使用SAS逐渐让我失去的耐心，极其臃肿和笨重，Vintage Car，交互页面也很糟糕，用起来很令人烦躁，遂改用R对数据进行分析。",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "R introduction",
      "CLHLS Data Analysis by R"
    ]
  },
  {
    "objectID": "Guide/R/2025-02-22-CLHLS.html#加载必要的包",
    "href": "Guide/R/2025-02-22-CLHLS.html#加载必要的包",
    "title": "CLHLS Data Analysis by R",
    "section": "",
    "text": "本文数据源来自北大开放研究数据平台。DVN/WBO7LK_2020\n使用SAS逐渐让我失去的耐心，极其臃肿和笨重，Vintage Car，交互页面也很糟糕，用起来很令人烦躁，遂改用R对数据进行分析。",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "R introduction",
      "CLHLS Data Analysis by R"
    ]
  },
  {
    "objectID": "Guide/R/2025-02-22-CLHLS.html#数据导出",
    "href": "Guide/R/2025-02-22-CLHLS.html#数据导出",
    "title": "CLHLS Data Analysis by R",
    "section": "\n2.1 数据导出",
    "text": "2.1 数据导出\n\nlibrary(writexl)  \n# 12. 保存描述性统计表格  \nwrite_xlsx(final_summary, \"C:/Users/asus/Desktop/test/CLHLS/Analysis-0214/Rsummary0223.xlsx\")  \n# 13. 保存结果  \nwrite_xlsx(final_data, \"C:/Users/asus/Desktop/test/CLHLS/Analysis-0214/final_data0223.xlsx\")",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "R introduction",
      "CLHLS Data Analysis by R"
    ]
  },
  {
    "objectID": "Guide/SAS/2025-02-16-CLHLS.html",
    "href": "Guide/SAS/2025-02-16-CLHLS.html",
    "title": "使用SAS处理CLHLS数据",
    "section": "",
    "text": "“中国老年健康影响因素跟踪调查”（简称“中国老年健康调查”，英文缩写CLHLS），以下简称CLHLS数据，是由北京大学健康老龄与发展研究中心/国家发展研究院组织的老年人追踪调查，调查范围覆盖全国23个省市自治区，调查对象为65岁及以上老年人和35-64岁成年子女，调查问卷分为存活被访者问卷和死亡老人家属问卷两种。存活被访者问卷的调查内容包括老人及家庭基本状况、社会经济背景及家庭结构、经济来源和经济状况、健康和生活质量自评、认知功能、性格心理特征、日常活动能力、生活方式、生活照料、疾病治疗和医疗费承担；死亡老人家属问卷的调查内容包括老人死亡时间、死因等内容。该调查项目在1998年进行基线调查后分别于2000 年、2002年、2005年、2008-2009年、2011-2012年、2014年和2017-2018年进行了跟踪调查，最近的一次跟踪调查(2017-2018年)共访问15,874 名65+岁老年人,收集了2014-2018年期间死亡的2,226位老年人的信息。“中国老年健康调查”累计入户访问11.3万人次，其中最需照料的80岁及以上高龄老人占总样本67.4%，其余为较低龄老人和中年对照组；同时访问2.89万位65+岁已死亡被访老人的直接家庭成员，收集了老人死亡前健康状况、生活质量与医疗和照料需求成本等详细数据。CLHLS数据共有15874例样本，761个变量，由于本文主要研究老年人的自评和客观健康水平以及代际支持模式对健康水平的影响，因此需要对样本和变量进行筛选，保留符合要求的样本和变量进行后续的分析。DVN/WBO7LK_2020",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "SAS introduction",
      "使用SAS处理CLHLS数据"
    ]
  },
  {
    "objectID": "Guide/SAS/2025-02-16-CLHLS.html#因变量的选取",
    "href": "Guide/SAS/2025-02-16-CLHLS.html#因变量的选取",
    "title": "使用SAS处理CLHLS数据",
    "section": "因变量的选取",
    "text": "因变量的选取\n老年人自评健康状况（SHEALTH）：对应变量 b12 （self-reported health），为有序变量（Ordinal），可用于衡量老年人对自身健康的主观评价，其赋值为：很好=1，好=2，一般=3，不好=4，很不好=5。\n生活自理能力（ADL）：对应变量 e1 （bathing，洗澡）、e2 （dressing，穿衣）、e3 （toileting，如厕）、e4 （indoor transferring，室内移动）、e5 （continence，大小便控制）、e6 （feeding，进食），均为有序变量（Ordinal）。通过这些变量的得分计算可体现老年人的生活自理能力。\n变量 e1b 、e2b 、e3b 、e4b 、e5b 、e6b 分别记录了在需要他人帮助情况下，这些活动的帮助持续天数，可作为辅助信息进一步分析生活自理能力情况。其变量赋值为：不需要帮扶=1，需要一个帮扶=2，需要多个帮扶=3，将其合并为ADL变量，相加值越低则表示生活自理能力越好，反之越差。\n工具型生活自理能力（IADL）：对应变量 e7 （able to go outside to visit neighbors，能外出拜访邻居）、e8 （able to go shopping by yourself，能自己去购物）、e9 （able to make food by yourself，能自己做饭）、e10 （able to wash clothes，能洗衣服）、e11 （able to walk one kilometer，能步行一公里）、e12 （able to carry 5kg weight，能搬运 5 公斤重物）、e13 （able to crouch and stand three times，能蹲下并站立三次）、e14 （able to take public transportation，能乘坐公共交通工具），均为有序变量（Ordinal）。这些变量可综合反映老年人在更复杂日常生活任务上的能力。其变量赋值为：可以=1，些微困难=2，不能=3，将其合并为IADL变量，相加值越低则表示工具型生活自理能力越好，反之越差。",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "SAS introduction",
      "使用SAS处理CLHLS数据"
    ]
  },
  {
    "objectID": "Guide/SAS/2025-02-16-CLHLS.html#自变量的选取",
    "href": "Guide/SAS/2025-02-16-CLHLS.html#自变量的选取",
    "title": "使用SAS处理CLHLS数据",
    "section": "自变量的选取",
    "text": "自变量的选取\n经济支持：新设变量为 economic-support，对应的原始变量 f12a （how much did you receive from your son (s) or daughter (s)-in-law last year，去年从儿子或儿媳处收到多少钱）、f12b （how much did you receive from your daughter (s) or son (s)-in-law last year，去年从女儿或女婿处收到多少钱）、f12c （how much did you receive from your grandchild (ren) last year，去年从孙辈处收到多少钱），均为尺度变量（Scale），其中给与物质支持=99998，不知道=88888，缺失=99999，通过统计99998的个数来估计经济支持的程度，如果没有99998则赋值为0,。通过这些变量可衡量子女及孙辈在物质上给予老年人的经济支持。\n照料支持：新设变量为：residence，对应原始变量a51（co-residence of interviewee，受访者居住情况），有人同住=1，独居=2，住在机构=3；新设变量为living，对应变量 a52（how many people are living with you，有多少人居住在一起），数值型变量；新设变量 visit-fren，对应细分变量为f103a5 （frequent visits of the 1st child，第一个孩子的探访频率）、f103b5 （frequent visits of the 2nd child，第二个孩子的探访频率）、f103c5 （frequent visits of the 3rd child，第三个孩子的探访频率）等（一直到 f103k5 等关于各个孩子的探访频率变量），均为有序变量（Ordinal），有探访=1，没有=2，任一一个孩子=1即可认为有探访，同时给新变量赋值为1，如果没有则给新变量赋值为0。\n设置care-support变量，如果residence=1或visit-fren=1则给care-support赋值为1，否则赋值为0。\n用这些变量以老年人与子女相处和见面的频率来间接反映子女对老人的照料支持情况。\n情感支持（emotion support）：对应细分变量 f103a6 （contact with the 1st child，与第一个孩子的联系情况）、f103b6 （contact with the 2nd child，与第二个孩子的联系情况）、f103c6 （contact with the 3rd child，与第三个孩子的联系情况）等（一直到 f103k6 等关于各个孩子的联系情况变量），均为名义变量（Nominal）。根据这些变量所反映的与子女联系的情况来体现子女对老人的情感关怀。有联系=1，没联系=2，任一一个为1即可说明有孩子联系。",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "SAS introduction",
      "使用SAS处理CLHLS数据"
    ]
  },
  {
    "objectID": "Guide/SAS/2025-02-16-CLHLS.html#控制变量的选取",
    "href": "Guide/SAS/2025-02-16-CLHLS.html#控制变量的选取",
    "title": "使用SAS处理CLHLS数据",
    "section": "控制变量的选取",
    "text": "控制变量的选取\n年龄：问卷中的 trueage “真实年龄”，用于获取老年人的实际年龄。\n性别：问卷中 a1 “性别”，男性赋值为 1，女性赋值为 2。\n受教育程度：问卷中的 f1 “受教育年限”，数值型变量，但是其中如果赋值为88或99则表示“不知道”或“缺失”。\n退休前的工作类型：问卷中 f2 “60 岁之前的主要职业”，名义变量，专业技术人员=0，政府、机构或管理人员=1，商业、服务或工业工人=2，自雇人士=3，农、林、牧或渔业工人=4，家政工人=5，军事人员=6，从未工作过=7，其他=8。\n婚姻状况：问卷中 f41 “您目前的婚姻状态是？”，将 “已婚或与伴侣同居” 赋值为 1，其他赋值为 0。\n户口类型：问卷中的 hukou “hukou type of the elderly being visited，被访老人的户口类型”， “城镇” 赋值为 1，“农村” 赋值为 2。\n社保和养老保险：问卷中的 nf64a f64b f64c（do you have any social security and social insurance now? 你是否有任何社保和社会保险？），有任何一种社保或养老保险则赋值为 1，没有赋值为 0；。\n医疗保险：问卷中f64d f64e f64f f64h(是否有医疗保险)，有任何一种医疗保险则赋值为 1，没有赋值为 0。\n子女年龄：通过对问卷中的 f103a4 f103b4 到 f103m4 来检查该老人的子女的年龄，如果最后一个还活着的孩子年龄&gt;60，赋值为1，则表示该老人的子女也是老年状态，否则为0。\n慢性病：问卷中 g15a1 g15b1 一直到 g15x1 表示是否患有某种慢性病，有任何一种慢性病赋值为 1，否则为 0。\n抽烟：问卷中 g151 “你24小时内抽烟吗？”，是赋值为 1，否赋值为 2。\n喝酒：问卷中 g161 “你24小时内饮酒吗？”，是赋值为 1，否赋值为 2。\n体育锻炼：问卷中d91 d92 分别表示“目前是否锻炼？”和“过去是否锻炼过？”，是赋值为 1，否赋值为 2。",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "SAS introduction",
      "使用SAS处理CLHLS数据"
    ]
  },
  {
    "objectID": "Guide/SAS/2025-02-16-CLHLS.html#纳入标准",
    "href": "Guide/SAS/2025-02-16-CLHLS.html#纳入标准",
    "title": "使用SAS处理CLHLS数据",
    "section": "纳入标准",
    "text": "纳入标准\n年龄要求：年龄大于 60 岁，通过实际年龄 &gt; 60进行筛选。60 岁以上人群处于老年阶段，其健康、社会角色和代际关系有老年群体特征，符合本研究对老年人的研究范围。\n生育情况：生育过子女，通过反映生育子女数量的变量（如 f10 生育子女数），要求f10 &gt; 0。代际支持模式研究需存在代际关系，生育子女是形成代际关系的前提。\n子女存活情况：所生育子女中至少有一个存活。可通过检查如 f103a3 - f103m3 等表示孩子存活情况的变量，只要有一个值为表示存活的标识即可纳入（原始数据的变量赋值为存活=1，去世=2）。有在世子女才能开展代际支持研究。",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "SAS introduction",
      "使用SAS处理CLHLS数据"
    ]
  },
  {
    "objectID": "Guide/SAS/2025-02-16-CLHLS.html#排除标准",
    "href": "Guide/SAS/2025-02-16-CLHLS.html#排除标准",
    "title": "使用SAS处理CLHLS数据",
    "section": "排除标准",
    "text": "排除标准\n关键变量缺失值：排除关键变量存在缺失值和无效值的样本。关键变量涵盖上述控制变量及后续分析的因变量、自变量等。缺失值或无效值会影响数据质量和分析结果准确性。\n不合理生育数量：生育子女数量超过合理上限（结合研究背景和数据确定，上限为 7）或者为缺失值，则需要排除（f10&gt;7 or f10 = null）。不合理生育数量可能是数据录入错误或特殊情况，干扰研究结果。\n通过多次尝试，以下是用于筛选的SAS代码：\n#| eval: false\n/* 导入必要的库 */\nproc import \n    datafile = 'C:\\Users\\asus\\Desktop\\test\\CLHLS\\Analysis-0214\\clhls_2018_15874.sav'  /* 请将这里替换为你的SAV文件的实际路径 */\n    out = raw_data \n    dbms = sav \n    replace;\nrun;\n\n/* 筛选合适的变量并排序 */\ndata selected_data;\n    set raw_data;\n    \n    /* 因变量 */\n    /* 老年人自评健康状况（SHEALTH） */\n    SHEALTH = b12;\n    \n    /* 生活自理能力（ADL） */\n    array adl_vars(*) e1 e2 e3 e4 e5 e6;\n    array adl_help_days(*) e1b e2b e3b e4b e5b e6b;\n    ADL = 0;\n    do i = 1 to dim(adl_vars);\n        if adl_help_days[i] = 1 then ADL = ADL + adl_vars[i];\n        else if adl_help_days[i] = 2 then ADL = ADL + adl_vars[i] * 2;\n        else if adl_help_days[i] = 3 then ADL = ADL + adl_vars[i] * 3;\n    end;\n    \n    /* 新增：生活自理障碍二分类变量 ADL2 */\n    ADL2 = 0;\n    do i = 1 to dim(adl_vars);\n        if adl_vars[i] &gt; 1 then do;\n            ADL2 = 1;\n            leave;\n        end;\n    end;\n    \n    /* 工具型生活自理能力（IADL） */\n    array iadl_vars(*) e7 e8 e9 e10 e11 e12 e13 e14;\n    IADL = 0;\n    do i = 1 to dim(iadl_vars);\n        IADL = IADL + iadl_vars[i];\n    end;\n    \n    /* 新增：工具型生活自理障碍二分类变量 IADL2 */\n    IADL2 = 0;\n    do i = 1 to dim(iadl_vars);\n        if iadl_vars[i] &gt; 1 then do;\n            IADL2 = 1;\n            leave;\n        end;\n    end;\n    \n    /* 自变量 */\n    /* 经济支持 */\n    array economic_vars(*) f12a f12b f12c;\n    economic_support = 0;\n    do i = 1 to dim(economic_vars);\n        if economic_vars[i] = 99998 then\n            economic_support = economic_support + 10000;\n        else if economic_vars[i] in (88888, 99999) then\n            continue; /* 跳过无效值或缺失值 */\n        else\n            economic_support = economic_support + economic_vars[i];\n    end;\n    \n    /* 照料支持 */\n    residence = a51;\n    living = a52;\n    array visit_freq(*) f103a5 f103b5 f103c5 f103d5 f103e5 f103f5 f103g5 f103h5 f103i5 f103j5 f103k5;\n    visit_fren = 0;\n    do i = 1 to dim(visit_freq);\n        if visit_freq[i] = 1 then do;\n            visit_fren = 1;\n            leave;\n        end;\n    end;\n    \n    /* 情感支持 */\n    array contact_vars(*) f103a6 f103b6 f103c6 f103d6 f103e6 f103f6 f103g6 f103h6 f103i6 f103j6 f103k6;\n    emotion_support = 2; /* 先假设没联系 */\n    do i = 1 to dim(contact_vars);\n        if contact_vars[i] = 1 then do;\n            emotion_support = 1;\n            leave;\n        end;\n    end;\n    \n    /* 控制变量 */\n    /* 年龄 */\n    age = trueage;\n    \n    /* 性别 */\n    gender = a1;\n    \n    /* 受教育程度 */\n    education = f1;\n    \n    /* 退休前的工作类型 */\n    job_type = f2;\n    \n    /* 婚姻状况 */\n    if f41 = 1 then marriage_status = 1; /* 假设 1 代表已婚或与伴侣同居 */\n    else marriage_status = 0;\n    \n    /* 户口类型 */\n    hukou_type = hukou;\n    \n    /* 社保和养老保险 */\n    if nf64a = 0 or f64b = 1 or f64c = 1 or f64i = 1 then social_insurance = 1;\n    else social_insurance = 0;\n    \n    /* 医疗保险 */\n    if f64d = 1 or f64e = 1 or f64g = 1 or f64h = 1 then medical_insurance = 1;\n    else medical_insurance = 0;\n    \n    /* 慢性病 */\n    array chronic_vars(*) g15a1 g15b1 g15c1 g15d1 g15e1 g15f1 g15g1 g15h1 g15i1 g15j1 g15k1 g15l1 g15m1 g15n1 g15o1 g15p1 g15q1 g15r1 g15s1 g15t1 g15u1 g15v1 g15w1 g15x1;\n    chronic_disease = 0;\n    do i = 1 to dim(chronic_vars);\n        if chronic_vars[i] = 1 then chronic_disease = 1;\n        if chronic_disease = 1 then leave;\n    end;\n    \n    /* 抽烟 */\n    smoking = g151;\n    \n    /* 喝酒 */\n    drinking = g161;\n    \n    /* 体育锻炼 */\n    if d91 = 1 or d92 = 1 then exercise = 1;\n    else exercise = 2;\n\n    /* 子女年龄状态 */\n    array child_ages(*) f103a4 f103b4 f103c4 f103d4 f103e4 f103f4 f103g4 f103h4 f103i4 f103j4 f103k4 f103l4 f103m4;\n    array child_alive(*) f103a3 f103b3 f103c3 f103d3 f103e3 f103f3 f103g3 f103h3 f103i3 f103j3 f103k3 f103l3 f103m3;\n    last_alive_child_age = .;\n    do i = dim(child_ages) to 1 by -1;\n        if child_alive[i] = 1 then do;\n            last_alive_child_age = child_ages[i];\n            leave;\n        end;\n    end;\n    if last_alive_child_age &gt; 60 then child_elderly_status = 1;\n    else child_elderly_status = 0;\n\n    /* 生成 care - support 变量 */\n    if residence = 1 or visit_fren = 1 then care_support = 1;\n    else care_support = 0;\n    \n    /* 选择需要的变量 */\n    keep SHEALTH ADL ADL2 IADL IADL2 economic_support residence living visit_fren emotion_support \n         f10 age gender education job_type marriage_status hukou_type \n         social_insurance medical_insurance chronic_disease smoking drinking exercise\n         child_elderly_status care_support f103a3 f103b3 f103c3 f103d3 f103e3 f103f3 f103g3 f103h3 f103i3 f103j3 f103k3 f103l3 f103m3;\nrun;\n\n/* 将筛选后的保存为 XLSX 格式文件 */\n/*\nproc export data=selected_data\n    outfile='C:\\Users\\asus\\Desktop\\test\\CLHLS\\CLHLS数据\\CLHLS数据\\clhls_2018_sort0220.xlsx'\n    dbms=xlsx\n    replace;\nrun;\n*/\n\n/*检查f10 生育子女数的分布情况*/\nproc freq data=selected_data;\n    tables f10;\nrun;\n\n/*检查子女存活状态*/\nproc freq data=selected_data;\n    tables f103a3 f103b3 f103c3 f103d3 f103e3 f103f3 f103g3 f103h3 f103i3 f103j3 f103k3 f103l3 f103m3;\nrun;\n\n/* 样本筛选 */\ndata temp_data;\n    set selected_data;\n\n    /* 纳入标准 */\n    /* 年龄要求 */\n    /*age_include = (age &gt; 60);*/\n    /* 生育情况 */\n    fertility_include = (f10 &gt; 0);\n\n    /* 子女存活情况 */\n    array child_alive(*) f103a3 f103b3 f103c3 f103d3 f103e3 f103f3 f103g3 f103h3 f103i3 f103j3 f103k3 f103l3 f103m3;\n    child_alive_include = 0;\n    do i = 1 to dim(child_alive);\n        if child_alive[i] = 1 then do;\n            child_alive_include = 1;\n            leave;\n        end;\n    end;\n    meet_include = fertility_include and child_alive_include;\n\n    /* 排除标准 */ \n    /* 关键变量缺失值检查 */\n    /*array key_vars(*) SHEALTH ADL IADL;*/\n    array key_vars(*) SHEALTH ADL ADL2 IADL IADL2 economic_support residence living visit_fren emotion_support \n                      age gender education job_type marriage_status hukou_type \n                      social_insurance medical_insurance chronic_disease smoking drinking exercise\n                      child_elderly_status care_support;\n    has_missing = 0;\n    do i = 1 to dim(key_vars);\n        if missing(key_vars[i]) then do;\n            has_missing = 1;\n            leave;\n        end;\n    end;\n    /* 不合理生育数量检查 */\n    unreasonable_fertility = (f10 &gt; 7 or missing(f10));\n    meet_exclude = has_missing or unreasonable_fertility;\n\n    /* 筛选符合条件的样本 */\n    if meet_include and not meet_exclude;\n\n\n    /* 移除临时判断变量 */\n    drop fertility_include child_alive_include has_missing unreasonable_fertility meet_include meet_exclude;\n    /*移除部分原始变量*/\n    drop f103a3 f103b3 f103c3 f103d3 f103e3 f103f3 f103g3 f103h3 f103i3 f103j3 f103k3 f103l3 f103m3;\nrun;\n\n/*打印所有变量的频数分布表，检查是否含有异常值*/\n/*\nproc freq data=final_data;\n    tables _all_;\nrun;\n*/\n\n/*还需要删除含有的样本，即某些变量中赋值为9（not applicable）和88（don't know）的样本*/\n/*具体需要剔除变量满足这些条件的样本：SHEALTH&gt;8,ADL&gt;18,IADL&gt;24,residence&gt;3,eudcation&gt;22,smoking&gt;2,drinking&gt;2*/\n/* 删除满足特定条件的样本 */\ndata final_data;\n    set temp_data;\n    if (SHEALTH &lt;= 8) and (ADL &lt;= 18) and (IADL &lt;= 24) and (residence &lt;= 3) and (age&gt;=60) and (education &lt;= 22) and (smoking &lt;= 2) and (drinking &lt;= 2);\nrun;\n\nproc freq data=final_data;\n    tables _all_;\nrun;\n\n/* 保存筛选后的数据为 XLSX 格式 */\nproc export\n    data = final_data\n    outfile = 'C:\\Users\\asus\\Desktop\\test\\CLHLS\\Analysis-0214\\final_data.xlsx' /* 请替换为实际保存路径 */\n    dbms = xlsx\n    replace;\nrun;\n\n/* 对 age 变量进行分组 */\ndata final_data_grouped;\n    set final_data;\n    if age &lt; 70 then age_group = '60 - 69';\n    else if age &lt; 80 then age_group = '70 - 79';\n    else if age &lt; 90 then age_group = '80 - 89';\n    else age_group = '90+';\nrun;\n\n/* 探查每个变量的基本统计信息，查看是否有异常值 */\nproc means data=final_data n nmiss min max mean std;\n    var SHEALTH ADL ADL2 IADL IADL2 economic_support residence living visit_fren emotion_support\n        age gender education job_type marriage_status hukou_type\n        social_insurance medical_insurance chronic_disease smoking drinking exercise\n        child_elderly_status care_support;\nrun;\n\n/* 查看字符型变量的唯一值，看是否有异常字符 */\nproc freq data=final_data_grouped;\n    tables age_group gender education job_type marriage_status hukou_type;\nrun;\n\n/* 打印因变量、自变量和控制变量的频数分布表并汇总 */\nproc freq data=final_data_grouped noprint;\n    tables SHEALTH ADL ADL2 IADL IADL2 economic_support residence living visit_fren emotion_support\n           age_group gender education job_type marriage_status hukou_type\n           social_insurance medical_insurance chronic_disease smoking drinking exercise\n           child_elderly_status care_support / out=freq_summary;\nrun;\n\n/* 导出频数汇总表到 Excel */\nproc export\n    data = freq_summary\n    outfile = 'C:\\Users\\asus\\Desktop\\test\\CLHLS\\Analysis-0214\\frequency_summary.xlsx' /* 请替换为实际保存路径 */\n    dbms = xlsx\n    replace;\nrun;\nNotes:在Qmd中输入SAS代码时，不可以直接使用\n```{sas eval=false} your SAS code here ```\n进行标注，应使用如下形式：\n```{sas} #| eval: false your code here ```\n否则会在输出报错，使用了错误的\n``````````````````` :::\n原因是因为，在 Quarto 中，fenced div 的正确语法是：\n::: {.class-name}  Content here  :::",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "SAS introduction",
      "使用SAS处理CLHLS数据"
    ]
  },
  {
    "objectID": "Quarto/config-giscus-github.html",
    "href": "Quarto/config-giscus-github.html",
    "title": "Qmd config giscus",
    "section": "",
    "text": "[giscus](https://giscus.app/zh-CN)\n\n\n\nGiscus是一个基于Github Discussion的评论插件，可以为无服务器端的博客运营者提供简易的部署和拓展。根据官网，其存在以下特性：\n开源！\n无跟踪，无广告，永久免费；\n无需数据库。全部数据均储存在 GitHub Discussions 中；\n支持自定义主题、多种语言、高度可配置；\n自动从 GitHub 拉取新评论与编辑；\n可自建服务！\n工作原理:\n  Giscus在加载时，会使用 GitHub Discussions 搜索 API 根据选定的映射方式（如 URL、pathname等）来查找与当前页面关联的discussion。如果找不到匹配的discussion，giscus bot就会在第一次有人留下评论或回应时自动创建一个discussion。\n\n  在评论时，访客必须按 GitHub OAuth 流程授权 giscus app 代表他发帖。或者访客也可以直接在 GitHub Discussion 里评论。你可以在 GitHub 上管理评论。\n\n\n\n\n首先要在GitHub建一个开放、可以使用Discussion的仓库，命名可以根据自己需要来，不能同网站仓库一致，因为独立存放评论内容。\n\n创建仓库完成后，请点击仓库最后一个选项setting，往下滑，找到Features功能区中的Discussion，点击勾选，开启仓库的Discussion功能，并安装giscus app ，点击连接并且install到对应新建的仓库就可以了。\n\n\n\n\n\n\nhttps://github.com/apps/giscus\n\nGiscus 应用库可以帮助你更方便地管理设置。通过上述链接进入网页进行安装：\n\n安装完成后转到如下页面，选择已创建好的comments仓库作为评论仓库。\n\n\n\n\n进入&lt;https://giscus.app/zh-CN&gt;配置页面，在该页面中根据自己的需求，选择配置。\n\n仓库选项是必须的，你需要把你创建好的comments仓库输入其中。\n选择合适的分类：\n\n嵌入到网站，在上述配置完成后，会生成一段script，将其放置在你想要展示评论的位置即可。",
    "crumbs": [
      "Home",
      "Quarto introduction",
      "Qmd config giscus"
    ]
  },
  {
    "objectID": "Quarto/config-giscus-github.html#什么是giscus",
    "href": "Quarto/config-giscus-github.html#什么是giscus",
    "title": "Qmd config giscus",
    "section": "",
    "text": "Giscus是一个基于Github Discussion的评论插件，可以为无服务器端的博客运营者提供简易的部署和拓展。根据官网，其存在以下特性：\n开源！\n无跟踪，无广告，永久免费；\n无需数据库。全部数据均储存在 GitHub Discussions 中；\n支持自定义主题、多种语言、高度可配置；\n自动从 GitHub 拉取新评论与编辑；\n可自建服务！\n工作原理:\n  Giscus在加载时，会使用 GitHub Discussions 搜索 API 根据选定的映射方式（如 URL、pathname等）来查找与当前页面关联的discussion。如果找不到匹配的discussion，giscus bot就会在第一次有人留下评论或回应时自动创建一个discussion。\n\n  在评论时，访客必须按 GitHub OAuth 流程授权 giscus app 代表他发帖。或者访客也可以直接在 GitHub Discussion 里评论。你可以在 GitHub 上管理评论。",
    "crumbs": [
      "Home",
      "Quarto introduction",
      "Qmd config giscus"
    ]
  },
  {
    "objectID": "Quarto/config-giscus-github.html#如何使用giscus",
    "href": "Quarto/config-giscus-github.html#如何使用giscus",
    "title": "Qmd config giscus",
    "section": "",
    "text": "首先要在GitHub建一个开放、可以使用Discussion的仓库，命名可以根据自己需要来，不能同网站仓库一致，因为独立存放评论内容。\n\n创建仓库完成后，请点击仓库最后一个选项setting，往下滑，找到Features功能区中的Discussion，点击勾选，开启仓库的Discussion功能，并安装giscus app ，点击连接并且install到对应新建的仓库就可以了。",
    "crumbs": [
      "Home",
      "Quarto introduction",
      "Qmd config giscus"
    ]
  },
  {
    "objectID": "Quarto/config-giscus-github.html#安装giscus-app",
    "href": "Quarto/config-giscus-github.html#安装giscus-app",
    "title": "Qmd config giscus",
    "section": "",
    "text": "https://github.com/apps/giscus\n\nGiscus 应用库可以帮助你更方便地管理设置。通过上述链接进入网页进行安装：\n\n安装完成后转到如下页面，选择已创建好的comments仓库作为评论仓库。",
    "crumbs": [
      "Home",
      "Quarto introduction",
      "Qmd config giscus"
    ]
  },
  {
    "objectID": "Quarto/config-giscus-github.html#配置giscus",
    "href": "Quarto/config-giscus-github.html#配置giscus",
    "title": "Qmd config giscus",
    "section": "",
    "text": "进入&lt;https://giscus.app/zh-CN&gt;配置页面，在该页面中根据自己的需求，选择配置。\n\n仓库选项是必须的，你需要把你创建好的comments仓库输入其中。\n选择合适的分类：\n\n嵌入到网站，在上述配置完成后，会生成一段script，将其放置在你想要展示评论的位置即可。",
    "crumbs": [
      "Home",
      "Quarto introduction",
      "Qmd config giscus"
    ]
  },
  {
    "objectID": "Guide/Python/Python-intro.html",
    "href": "Guide/Python/Python-intro.html",
    "title": "Python introduction",
    "section": "",
    "text": "Python（英式发音：/ˈpaɪθən/；美式发音：/ˈpaɪθɑːn/），是一种广泛使用的解释型、高级和通用的编程语言。Python支持多种编程范型，包括结构化、过程式、反射式、面向对象和函数式编程。它拥有动态类型系统和垃圾回收功能，能够自动管理内存使用，并且其本身拥有一个巨大而广泛的标准库。它的语言结构以及面向对象的方法，旨在帮助程序员为小型的和大型的项目编写逻辑清晰的代码。",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "Python introduction"
    ]
  },
  {
    "objectID": "Guide/Python/2025-02-22-Med-Exp-Ana.html",
    "href": "Guide/Python/2025-02-22-Med-Exp-Ana.html",
    "title": "Med-Exp-Analysize",
    "section": "",
    "text": "对符合分析条件后的样本，按照文章需要进行分析。\n\n\nCode\nimport pandas as pd\n\n# 导入 Excel 文件\nfile_path = \"C:/Users/asus/Desktop/test/stata/prepare.xlsx\"\noutput_path = \"C:/Users/asus/Desktop/test/stata/data/merge-data.xlsx\"\nfinal_output_path = \"C:/Users/asus/Desktop/test/stata/data/cleaned-merge-data.xlsx\"\nsheet_names = [\"2018\", \"2019\", \"2020\", \"2021\", \"2022\", \"2023\"]\n\n# 读取所有 sheet 的数据\nsheets_data = {sheet: pd.read_excel(file_path, sheet_name=sheet) for sheet in sheet_names}\n\n# 获取每个 sheet 的列名\nsheets_columns = {sheet: set(data.columns) for sheet, data in sheets_data.items()}\n\n# 找出所有 sheet 的共同变量\ncommon_columns = set.intersection(*sheets_columns.values())\ncommon_columns = list(common_columns)  # 保持原始顺序\n\n# 修改这部分代码以避免 SettingWithCopyWarning\nprocessed_sheets = []\nfor sheet, data in sheets_data.items():\n    # 创建新的 DataFrame 而不是视图\n    sheet_data = data[common_columns].copy()\n    sheet_data.loc[:, 'year'] = sheet\n    processed_sheets.append(sheet_data)\n\n# 合并所有 sheet 的数据\nmerged_data = pd.concat(processed_sheets, ignore_index=True)\n\n# 输出合并后的数据到指定路径\nmerged_data.to_excel(output_path, index=False)\n\n# 重新导入合并后的数据\nmerged_data = pd.read_excel(output_path)\n\n# 剔除键值全部为 null 或 0 的变量，同时保持原始变量的顺序\nnon_null_columns = merged_data.dropna(axis=1, how='all').columns\nnon_zero_columns = merged_data.loc[:, (merged_data != 0).any(axis=0)].columns\nvalid_columns = [col for col in merged_data.columns if col in non_null_columns and col in non_zero_columns]\n\ncleaned_data = merged_data.loc[:, valid_columns]\n\n# 输出清理后的数据到指定路径\ncleaned_data.to_excel(final_output_path, index=False)\n\nprint(f\"清理后的数据已输出到 {final_output_path}\")\n\n# 展示部分数据，设置随机种子以确保可重复性\nsample_data = cleaned_data.sample(n=10, random_state=42)\nprint(sample_data)\n\n\n清理后的数据已输出到 C:/Users/asus/Desktop/test/stata/data/cleaned-merge-data.xlsx\n       3.4麻醉费  国籍  术前住院天数2  次数                4手术时间  3.1非手术治疗项目费  \\\n10556    19.0  中国      NaN   1                  NaN         25.0   \n3602      0.0  中国      NaN   1                  NaN         24.8   \n26405   315.0  中国      NaN   1                  NaN       4693.6   \n36012   315.0  中国      1.0   2                  NaN         44.7   \n37445   668.0  中国      NaN   1                  NaN        241.9   \n47770     0.0  中国      0.0   1  2023-11-20 12:25:00       3051.9   \n40811     0.0  中国      NaN   1                  NaN       6315.2   \n3457      0.0  中国      NaN   1                  NaN       1366.6   \n40726     0.0  中国      NaN   1                  NaN         20.1   \n19409  1150.0  中国      NaN   1                  NaN        582.2   \n\n                    4手术名称 死亡患者尸检               3手术名称     总药品费  ...  1愈合  \\\n10556                 NaN    NaN                 NaN   152.98  ...    甲   \n3602                  NaN    NaN                 NaN   206.59  ...    甲   \n26405                 NaN    NaN  内镜下直肠息肉氩离子凝固术（APC)   386.35  ...    甲   \n36012                 NaN    NaN                 NaN   219.85  ...   其他   \n37445                 NaN    NaN                 NaN   657.82  ...    甲   \n47770  内镜下直肠息肉氩离子凝固术（APC)    NaN  内镜下结肠病损氩气刀治疗术（APC)   196.31  ...   其他   \n40811                 NaN    NaN                 NaN   256.37  ...  NaN   \n3457                  NaN    NaN                 NaN  7496.43  ...  NaN   \n40726                 NaN    NaN                 NaN  2487.22  ...  NaN   \n19409                 NaN    NaN                 NaN  3394.30  ...    甲   \n\n             1手术编码       总费用  切口部位2 是否有使用抗菌药物2              手术开始时间1 麻醉分级1  \\\n10556     11.32003   2032.28    NaN        NaN                  NaN   NaN   \n3602      13.71001   7709.59    NaN        NaN                  NaN   NaN   \n26405  45.4300x010   8090.91    NaN        NaN                  NaN   NaN   \n36012      45.2300   2200.65     其他          无  2022-07-14 09:30:27    P1   \n37445      53.1701   9172.39    NaN        NaN  2022-09-14 10:15:18    P1   \n47770      48.3510   4531.74     其他          无  2023-11-20 12:25:32    P1   \n40811          NaN   8713.35    NaN        NaN                  NaN   NaN   \n3457           NaN  15042.23    NaN        NaN                  NaN   NaN   \n40726          NaN   3193.07    NaN        NaN                  NaN   NaN   \n19409     06.39013  17627.08    NaN        NaN                  NaN   NaN   \n\n       切口等级1            1手术名称  year  \n10556    NaN  翼状胬肉切除伴自体干细胞移植术  2019  \n3602     NaN  白内障摘除伴人工晶体一期置入术  2019  \n26405    NaN  内镜下结肠黏膜切除术(EMR)  2021  \n36012      0            结肠镜检查  2022  \n37445      Ⅰ     双侧腹股沟疝无张力修补术  2022  \n47770      0  内镜下直肠黏膜切除术(EMR)  2023  \n40811    NaN              NaN  2023  \n3457     NaN              NaN  2019  \n40726    NaN              NaN  2023  \n19409    NaN       双侧甲状腺次全切除术  2020  \n\n[10 rows x 160 columns]\n\n\n160个变量，变量还是太多了，试着把含有超过一半缺失值的变量也剔除出去，并且把入院年份和出院年份的年份提取出来，并与year变量做比较，如果入院年份和出院年份通year不一致则剔除此样本，载入合并后的数据进行处理"
  },
  {
    "objectID": "Guide/R/2025-02-22-CLHLS.html#描述性统计",
    "href": "Guide/R/2025-02-22-CLHLS.html#描述性统计",
    "title": "CLHLS Data Analysis by R",
    "section": "\n2.2 描述性统计",
    "text": "2.2 描述性统计",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "R introduction",
      "CLHLS Data Analysis by R"
    ]
  },
  {
    "objectID": "Guide/R/2025-02-22-CLHLS.html#构建logistic回归方程",
    "href": "Guide/R/2025-02-22-CLHLS.html#构建logistic回归方程",
    "title": "CLHLS Data Analysis by R",
    "section": "\n3.1 构建logistic回归方程",
    "text": "3.1 构建logistic回归方程",
    "crumbs": [
      "Home",
      "统计软件使用指南",
      "R introduction",
      "CLHLS Data Analysis by R"
    ]
  },
  {
    "objectID": "Learn/Basic/10-regression-correlation.html",
    "href": "Learn/Basic/10-regression-correlation.html",
    "title": "简单线性相关和回归",
    "section": "",
    "text": "two variables relationship\n\n\n\n\n\nThe basic process of straight-line regression analysis\n\n\n\n\n\n\n\n\n名称\n适用条件\n\n\n\nPearson直线相关系数\n双变量正态分布的资料\\(\\rightarrow\\)定量\\(\\rightarrow\\)类比t检验、方差分析\n\n\n列联系数\n非等级资料\\(\\rightarrow\\)分类\\(\\rightarrow\\)类比卡方检验\n\n\nSpearman秩相关系数\n不满足双变量正态分布、分布未知、等级资料\\(\\rightarrow\\)定量+分类\\(\\rightarrow\\)类比秩和检验\n\n\n\n\n\n\nDraw a scatterplot\n\n\n选择一组数据集的“最佳拟合直线”，需要设法通过观测数据确定参数\\(\\alpha\\)与\\(\\beta\\)的估计值a和b，使得直线\n\\[\\hat y=a+bx\\]\n能最佳地反映\\((x_i,y_i)\\)之间的变化关系，该直线称为一元回归直线。\n常用最小二乘估计法（least squares estimation）来最佳直线，其基本原理是通过最小化残差平方和，使得各观测点到回归直线的纵向距离的平方和最小。\n\\[\n\\begin{cases}\na=\\bar y-b \\bar x\\\\\nb=\\frac{\\sum\\limits_{i=1}^n x_i y_i - \\frac{1}{n}(\\sum\\limits_{i=1}^n x_i)(\\sum\\limits_{i=1}^n y_i)}{\\sum\\limits_{i=1}^n x_i^2 - \\frac{1}{n}(\\sum\\limits_{i=1}^n x_i)^2}\n\\end{cases}\n\\] 为方便，引入以下记号： \\[\nSS_{xx}=\\sum_{i}(x_i-\\bar x)^2=\\sum_{i}x_i^2-\\frac{1}{n}(\\sum_{i}x_i)^2\\\\\nSS_{yy}=\\sum_{i}(y_i-\\bar y)^2=\\sum_{i}y_i^2-\\frac{1}{n}(\\sum_{i}y_i)^2\\\\\nSS_{xy}=\\sum_{i}(x_i-\\bar x)(y_i-\\bar y)=\\sum_{i}x_i y_i-\\frac{1}{n}(\\sum_{i}x_i)(\\sum_{i}y_i)\n\\] 其中，\\(SS_{xx}\\)和\\(SS_{yy}\\)是离均差平方和，\\(SS_{xy}\\)称为离均差积和。\n这样可以简化为： \\[\n\\begin{cases}\na=\\bar y-b \\bar x\\\\\nb=\\frac{SS_{xy}}{SS_{xx}}\n\\end{cases}\n\\]\n\n\nF检验\n\n\\(y_i\\)的总离均差平方和为：\n\\[SS_{yy}=\\sum_{i}(y_i-\\bar y)^2\\] 对其做分解，得到等式：\n\\[SS_{yy}=\\sum_{i}^{n}(\\hat y_i-\\bar y)^2+\\sum_{i}^{n}(y_i-\\hat y_i)^2\\] \\(\\sum_{i}^{n}(\\hat y_i-\\bar y)^2\\)为回归平方和（regression sum of squares），记为\\(SS_R\\)，表示回归估计值\\(\\hat y_i\\)与均数\\(\\bar y\\)的离差平方和，其公式为：\n\\[\n\\begin{align}\nSS_{yy} &= \\sum_{i=1}^{n}(\\hat y_i - \\bar y)^2 \\\\\n        &= \\sum_{i=1}^{n}[a + bx_i - (a + b\\bar x)]^2 \\\\\n        &= SS_{xx}b^2 \\\\\n        &= SS_{xy}b\n\\end{align}\n\\] 显然，回归平方和\\(SS_{R}\\)反映的是在y的总变异中由x与y的直线回归关系解释的那部分变异。\\(SS_R\\)值越大，说明回归直线的拟合效果就越好。\n\\(\\sum_{i}^{n}(y_i-\\hat y_i)^2\\)为残差平方和（residual sum of squares），记为\\(SS_E\\)，表示观测值\\(y_i\\)与回归估计值\\(\\hat y_i\\)的离差平方和，其公式为： \\[SS_E=\\sum_{i=1}^{n}(y_i-\\hat y_i)^2\\] \\(SS_E\\)反映了在总变异中扣除自变量x对因变量y的线性影响以后的其他因素（包括x对y的非线性影响和随机误差等）对y变异的影响，也就是在总平方和中无法用y和x线性回归关系解释的部分。\\(SS_E\\)值越小，说明回归直线的拟合效果就越好。\n对公式进行简化： \\[\\begin{align}\nSS_{yy}=&\\sum_{i}^{n}(\\hat y_i-\\bar y)^2+\\sum_{i}^{n}(y_i-\\hat y_i)^2\\\\\n=&SS_R+SS_E\n\\end{align}\\] 上述三个平方和，各有其相应的自由度\\(v\\)，并有如下关系： \\[v_{yy}=v_R+v_E\\\\\nv_{yy}=n-1,v_R=1,v_E=n-2\\]\n在\\(H_0\\)成立的条件下，有： \\[\\frac{SS_R}{\\sigma^2}\\sim \\chi^2(v_R),\\frac{SS_E}{\\sigma^2}\\sim \\chi^2(v_E)\\] 且\\(SS_R\\)和\\(SS_E\\)相互独立。\n检验统计量：\n\\[F=\\frac{SS_R/v_R}{SS_E/v_E}\\] 服从自由度\\(v_R=1,v_E=n-2\\)的F分布。如果y和x确实存在直线回归关系，那么回归所解释的变异\\(SS_R\\)应大于其他因素所解释的变异\\(SS_E\\)。由此可见，F检验正是建立在这个基础上的。\n对于给定的检验水准\\(\\alpha\\)， 如果\\(F&gt;F_{(v_R,v_E),1-\\alpha}\\)，则拒绝\\(H_0\\)，认为直线回归方程有统计学显著性；\n如果\\(F\\leq F_{(v_R,v_E),1-\\alpha}\\)，则不拒绝\\(H_0\\)，尚不能认为直线回归方程有统计学显著性。\n\nt检验法\n\n\n\n\n\n\n\n\n区别与联系\n类目\n内容\n\n\n\n区别\n资料要求\n1. 线性相关要求X,Y服从双变量正态分布，对这种资料进行回归分析称为\\(\\textrm{II}\\)型回归，即可以把X当自变量，也可以当因变量，反之亦然。2. 线性回归要求Y在给定X值时服从正态分布，X可以是精确测量和严格控制的变量，这时的回归称为型回归，即不可以把X当因变量，Y当自变量进行回归分析。\n\n\n\n\n应用\n1. 线性相关用来表达两个变量间的互依关系，两个变量的研究地位是相等的，谁做X，谁做Y都可以；2. 线性回归用来表达两个变量间的依存变化的数量关系，即一个变量（为因变量Y）如何依存于另一个变量（为自变量X）而变化，两个变量的研究地位是不相等的。\n\n\n\n意义\n1. 相关系数r说明具有线性关系的两个变量之间的密切程度和相关方向；2. 回归系数b表示X每变化一个单位所导致的Y的平均变化量。\n\n\n\nr和b的取值范围\nr没有单位，而b有单位（其单位是：Y的单位/X的单位），所以导致两者的取值范围不同；\\(-1 \\le r \\le 1\\),\\(-\\infty&lt;b&lt;+\\infty\\)\n\n\n\n\nr和b的计算公式不同\n\n\\(r=\\frac{l_{xy}}{\\sqrt{l_{xx}l_{yy}}}\\),\\(b=\\frac{l_{xy}}{l_{xx}}\\)\n\n\n\n联系\n符号\n对于既可以做相关又可作回归的同一组资料，计算出r与b的正负号相同\n\n\n\n假设检验\n对于同一组资料，相关系数和回归系数的假设检验等价。即有：\\(t_b=t_r\\)\n\n\n\n\n相互换算\n对于同一组资料，相关系数和回归系数可通过下式换算：\\(b=r\\frac{S_Y}{S_X}\\)，式中的\\(S_X,S_Y\\)分别是\\(X,Y\\)的标准差\n\n\n\n用回归解释相关\n又决定系数\\(R^2=\\frac{SS_{回}}{SS_{总}}\\)，当总平方和的大小决定了相关的密切程度，回归平方和越接近总平方和，则\\(R^2\\)越接近1，相关的效果越好，说明回归效果越好，相关的密切程度也越高。\n\n\n\nnotice：关于双变量正态分布\n双元正态变量是指两个随机变量同时遵循正态分布的情况，通常记作 \\((X, Y) \\sim N(\\mu, \\Sigma)\\)，其中 \\(\\mu\\) 是均值向量，\\(\\Sigma\\) 是协方差矩阵。\n数学定义\n1.  均值向量：对于双元正态变量 $(X, Y)$，均值向量为：\n\\[\\mu = \\begin{pmatrix}\n\\mu_X \\\\\n\\mu_Y\n\\end{pmatrix}\\]\n其中 \\(\\mu_X\\) 和 \\(\\mu_Y\\) 分别是随机变量 \\(X\\) 和 \\(Y\\) 的均值。 2. 协方差矩阵：协方差矩阵为：\n\\[\\Sigma = \\begin{pmatrix}\n\\sigma_X^2 & \\sigma_{XY} \\\\\n\\sigma_{XY} & \\sigma_Y^2\n\\end{pmatrix}\\]\n其中 \\(\\sigma_X^2\\) 和 \\(\\sigma_Y^2\\) 是 \\(X\\) 和 \\(Y\\) 的方差，\\(\\sigma_{XY}\\) 是它们之间的协方差。\n性质\n•   边缘分布：$X$ 和 $Y$ 的边缘分布也是正态分布。\n•   条件分布：给定 $X$ 的值，$Y$ 的条件分布也是正态分布。\n•   相关性：协方差矩阵的值可以用来判断 X 和 Y 之间的相关性。如果 $\\sigma_{XY} &gt; 0$，则两者正相关；如果 $\\sigma_{XY} &lt; 0$，则负相关。\n示例\n假设有一组数据描述学生的身高 \\(X\\) 和体重 \\(Y\\)，并且假设 \\((X, Y)\\) 服从双元正态分布：\n•   均值向量：\n\\[\\mu = \\begin{pmatrix}\n170 \\\\\n65\n\\end{pmatrix}\\]\n表示身高的均值为 170 厘米，体重的均值为 65 千克。 • 协方差矩阵：\n\\[\\Sigma = \\begin{pmatrix}\n100 & 20 \\\\\n20 & 25\n\\end{pmatrix}\\]\n这里，身高的方差为 100，体重的方差为 25，协方差为 20，表示身高和体重之间存在正相关关系。\n在这个示例中，如果我们知道某个学生的身高为 180 厘米，我们可以利用条件分布来预测他的体重，这个体重的预测值也是正态分布。\n我们用一个图形来展示：\n\n## 安装和加载所需的包\n#install.packages(\"plotly\")\n#install.packages(\"mvtnorm\")\nlibrary(plotly)\nlibrary(mvtnorm)\nlibrary(webshot2)\n\n# 创建网格数据\nx &lt;- seq(150, 190, length.out = 100)\n#身高150-190，等距的100个值\ny &lt;- seq(50, 80, length.out = 100)\n#体重50-80，等距的100个值\ngrid &lt;- expand.grid(X = x, Y = y)\n#生成 x 和 y 的所有组合，用于构建一个网格数据框，以便计算多元正态分布的概率密度。\n\n# 设置均值和协方差矩阵\nmu &lt;- c(170, 65)\n#设置双元正态分布的均值向量，表示均值分别为身高 170 cm 和体重 65 kg\n\nsigma &lt;- matrix(c(100, 20, 20, 25), nrow = 2)\n#设置协方差矩阵，表示身高的方差为 100，体重的方差为 25，身高和体重之间的协方差为 20\n\n# 计算概率密度\nz &lt;- dmvnorm(as.matrix(grid), mean = mu, sigma = sigma)\n#计算每个网格点上双元正态分布的概率密度。\n\n# 将概率密度矩阵转换为适合绘图的形状\nz_matrix &lt;- matrix(z, nrow = 100, ncol = 100)\n\n# 绘制三维表面图\nplot_ly(x = x, y = y, z = z_matrix, type = \"surface\") %&gt;%\n  layout(title = list(text = \"双元正态分布的三维概率密度图\", y=0.95),\n         scene = list(xaxis = list(title = \"身高 (cm)\"),\n                      yaxis = list(title = \"体重 (kg)\"),\n                      zaxis = list(title = \"概率密度\")))\n\n\nBinary normal distribution\n\n\n注：上述图像在被转换为PDF文件时，会发生报错：Quarto 文档中包含了一些生成 HTML 输出的函数（比如交互式图表或其他 HTML 小部件），但你当前的目标输出格式是 PDF。由于 PDF 是静态格式，无法直接渲染 HTML 内容，Quarto 会报错并停止执行。\n解决方案，此章节不转换为PDF格式，或者：\n如果你仍想输出 PDF，但希望将 HTML 小部件作为静态截图嵌入，可以安装 R 的 webshot 或 webshot2 包。Quarto 会利用它们将 HTML 内容转换为图片。\n需要安装：\n\ninstall.packages(\"webshot2\")\n\n然后在这段程序的前部导入该包：library(webshot2)。",
    "crumbs": [
      "Home",
      "医学统计学基础",
      "简单线性相关和回归"
    ]
  },
  {
    "objectID": "Learn/Basic/10-regression-correlation.html#两变量关系分析",
    "href": "Learn/Basic/10-regression-correlation.html#两变量关系分析",
    "title": "简单线性相关和回归",
    "section": "",
    "text": "two variables relationship",
    "crumbs": [
      "Home",
      "医学统计学基础",
      "简单线性相关和回归"
    ]
  },
  {
    "objectID": "Learn/Basic/10-regression-correlation.html#常见相关系数",
    "href": "Learn/Basic/10-regression-correlation.html#常见相关系数",
    "title": "简单线性相关和回归",
    "section": "",
    "text": "The basic process of straight-line regression analysis\n\n\n\n\n\n\n\n\n名称\n适用条件\n\n\n\nPearson直线相关系数\n双变量正态分布的资料\\(\\rightarrow\\)定量\\(\\rightarrow\\)类比t检验、方差分析\n\n\n列联系数\n非等级资料\\(\\rightarrow\\)分类\\(\\rightarrow\\)类比卡方检验\n\n\nSpearman秩相关系数\n不满足双变量正态分布、分布未知、等级资料\\(\\rightarrow\\)定量+分类\\(\\rightarrow\\)类比秩和检验",
    "crumbs": [
      "Home",
      "医学统计学基础",
      "简单线性相关和回归"
    ]
  },
  {
    "objectID": "Learn/Basic/10-regression-correlation.html#简单直线回归",
    "href": "Learn/Basic/10-regression-correlation.html#简单直线回归",
    "title": "简单线性相关和回归",
    "section": "",
    "text": "Draw a scatterplot\n\n\n选择一组数据集的“最佳拟合直线”，需要设法通过观测数据确定参数\\(\\alpha\\)与\\(\\beta\\)的估计值a和b，使得直线\n\\[\\hat y=a+bx\\]\n能最佳地反映\\((x_i,y_i)\\)之间的变化关系，该直线称为一元回归直线。\n常用最小二乘估计法（least squares estimation）来最佳直线，其基本原理是通过最小化残差平方和，使得各观测点到回归直线的纵向距离的平方和最小。\n\\[\n\\begin{cases}\na=\\bar y-b \\bar x\\\\\nb=\\frac{\\sum\\limits_{i=1}^n x_i y_i - \\frac{1}{n}(\\sum\\limits_{i=1}^n x_i)(\\sum\\limits_{i=1}^n y_i)}{\\sum\\limits_{i=1}^n x_i^2 - \\frac{1}{n}(\\sum\\limits_{i=1}^n x_i)^2}\n\\end{cases}\n\\] 为方便，引入以下记号： \\[\nSS_{xx}=\\sum_{i}(x_i-\\bar x)^2=\\sum_{i}x_i^2-\\frac{1}{n}(\\sum_{i}x_i)^2\\\\\nSS_{yy}=\\sum_{i}(y_i-\\bar y)^2=\\sum_{i}y_i^2-\\frac{1}{n}(\\sum_{i}y_i)^2\\\\\nSS_{xy}=\\sum_{i}(x_i-\\bar x)(y_i-\\bar y)=\\sum_{i}x_i y_i-\\frac{1}{n}(\\sum_{i}x_i)(\\sum_{i}y_i)\n\\] 其中，\\(SS_{xx}\\)和\\(SS_{yy}\\)是离均差平方和，\\(SS_{xy}\\)称为离均差积和。\n这样可以简化为： \\[\n\\begin{cases}\na=\\bar y-b \\bar x\\\\\nb=\\frac{SS_{xy}}{SS_{xx}}\n\\end{cases}\n\\]\n\n\nF检验\n\n\\(y_i\\)的总离均差平方和为：\n\\[SS_{yy}=\\sum_{i}(y_i-\\bar y)^2\\] 对其做分解，得到等式：\n\\[SS_{yy}=\\sum_{i}^{n}(\\hat y_i-\\bar y)^2+\\sum_{i}^{n}(y_i-\\hat y_i)^2\\] \\(\\sum_{i}^{n}(\\hat y_i-\\bar y)^2\\)为回归平方和（regression sum of squares），记为\\(SS_R\\)，表示回归估计值\\(\\hat y_i\\)与均数\\(\\bar y\\)的离差平方和，其公式为：\n\\[\n\\begin{align}\nSS_{yy} &= \\sum_{i=1}^{n}(\\hat y_i - \\bar y)^2 \\\\\n        &= \\sum_{i=1}^{n}[a + bx_i - (a + b\\bar x)]^2 \\\\\n        &= SS_{xx}b^2 \\\\\n        &= SS_{xy}b\n\\end{align}\n\\] 显然，回归平方和\\(SS_{R}\\)反映的是在y的总变异中由x与y的直线回归关系解释的那部分变异。\\(SS_R\\)值越大，说明回归直线的拟合效果就越好。\n\\(\\sum_{i}^{n}(y_i-\\hat y_i)^2\\)为残差平方和（residual sum of squares），记为\\(SS_E\\)，表示观测值\\(y_i\\)与回归估计值\\(\\hat y_i\\)的离差平方和，其公式为： \\[SS_E=\\sum_{i=1}^{n}(y_i-\\hat y_i)^2\\] \\(SS_E\\)反映了在总变异中扣除自变量x对因变量y的线性影响以后的其他因素（包括x对y的非线性影响和随机误差等）对y变异的影响，也就是在总平方和中无法用y和x线性回归关系解释的部分。\\(SS_E\\)值越小，说明回归直线的拟合效果就越好。\n对公式进行简化： \\[\\begin{align}\nSS_{yy}=&\\sum_{i}^{n}(\\hat y_i-\\bar y)^2+\\sum_{i}^{n}(y_i-\\hat y_i)^2\\\\\n=&SS_R+SS_E\n\\end{align}\\] 上述三个平方和，各有其相应的自由度\\(v\\)，并有如下关系： \\[v_{yy}=v_R+v_E\\\\\nv_{yy}=n-1,v_R=1,v_E=n-2\\]\n在\\(H_0\\)成立的条件下，有： \\[\\frac{SS_R}{\\sigma^2}\\sim \\chi^2(v_R),\\frac{SS_E}{\\sigma^2}\\sim \\chi^2(v_E)\\] 且\\(SS_R\\)和\\(SS_E\\)相互独立。\n检验统计量：\n\\[F=\\frac{SS_R/v_R}{SS_E/v_E}\\] 服从自由度\\(v_R=1,v_E=n-2\\)的F分布。如果y和x确实存在直线回归关系，那么回归所解释的变异\\(SS_R\\)应大于其他因素所解释的变异\\(SS_E\\)。由此可见，F检验正是建立在这个基础上的。\n对于给定的检验水准\\(\\alpha\\)， 如果\\(F&gt;F_{(v_R,v_E),1-\\alpha}\\)，则拒绝\\(H_0\\)，认为直线回归方程有统计学显著性；\n如果\\(F\\leq F_{(v_R,v_E),1-\\alpha}\\)，则不拒绝\\(H_0\\)，尚不能认为直线回归方程有统计学显著性。\n\nt检验法",
    "crumbs": [
      "Home",
      "医学统计学基础",
      "简单线性相关和回归"
    ]
  },
  {
    "objectID": "Learn/Basic/10-regression-correlation.html#直线相关与直线回归的比较",
    "href": "Learn/Basic/10-regression-correlation.html#直线相关与直线回归的比较",
    "title": "简单线性相关和回归",
    "section": "",
    "text": "区别与联系\n类目\n内容\n\n\n\n区别\n资料要求\n1. 线性相关要求X,Y服从双变量正态分布，对这种资料进行回归分析称为\\(\\textrm{II}\\)型回归，即可以把X当自变量，也可以当因变量，反之亦然。2. 线性回归要求Y在给定X值时服从正态分布，X可以是精确测量和严格控制的变量，这时的回归称为型回归，即不可以把X当因变量，Y当自变量进行回归分析。\n\n\n\n\n应用\n1. 线性相关用来表达两个变量间的互依关系，两个变量的研究地位是相等的，谁做X，谁做Y都可以；2. 线性回归用来表达两个变量间的依存变化的数量关系，即一个变量（为因变量Y）如何依存于另一个变量（为自变量X）而变化，两个变量的研究地位是不相等的。\n\n\n\n意义\n1. 相关系数r说明具有线性关系的两个变量之间的密切程度和相关方向；2. 回归系数b表示X每变化一个单位所导致的Y的平均变化量。\n\n\n\nr和b的取值范围\nr没有单位，而b有单位（其单位是：Y的单位/X的单位），所以导致两者的取值范围不同；\\(-1 \\le r \\le 1\\),\\(-\\infty&lt;b&lt;+\\infty\\)\n\n\n\n\nr和b的计算公式不同\n\n\\(r=\\frac{l_{xy}}{\\sqrt{l_{xx}l_{yy}}}\\),\\(b=\\frac{l_{xy}}{l_{xx}}\\)\n\n\n\n联系\n符号\n对于既可以做相关又可作回归的同一组资料，计算出r与b的正负号相同\n\n\n\n假设检验\n对于同一组资料，相关系数和回归系数的假设检验等价。即有：\\(t_b=t_r\\)\n\n\n\n\n相互换算\n对于同一组资料，相关系数和回归系数可通过下式换算：\\(b=r\\frac{S_Y}{S_X}\\)，式中的\\(S_X,S_Y\\)分别是\\(X,Y\\)的标准差\n\n\n\n用回归解释相关\n又决定系数\\(R^2=\\frac{SS_{回}}{SS_{总}}\\)，当总平方和的大小决定了相关的密切程度，回归平方和越接近总平方和，则\\(R^2\\)越接近1，相关的效果越好，说明回归效果越好，相关的密切程度也越高。\n\n\n\nnotice：关于双变量正态分布\n双元正态变量是指两个随机变量同时遵循正态分布的情况，通常记作 \\((X, Y) \\sim N(\\mu, \\Sigma)\\)，其中 \\(\\mu\\) 是均值向量，\\(\\Sigma\\) 是协方差矩阵。\n数学定义\n1.  均值向量：对于双元正态变量 $(X, Y)$，均值向量为：\n\\[\\mu = \\begin{pmatrix}\n\\mu_X \\\\\n\\mu_Y\n\\end{pmatrix}\\]\n其中 \\(\\mu_X\\) 和 \\(\\mu_Y\\) 分别是随机变量 \\(X\\) 和 \\(Y\\) 的均值。 2. 协方差矩阵：协方差矩阵为：\n\\[\\Sigma = \\begin{pmatrix}\n\\sigma_X^2 & \\sigma_{XY} \\\\\n\\sigma_{XY} & \\sigma_Y^2\n\\end{pmatrix}\\]\n其中 \\(\\sigma_X^2\\) 和 \\(\\sigma_Y^2\\) 是 \\(X\\) 和 \\(Y\\) 的方差，\\(\\sigma_{XY}\\) 是它们之间的协方差。\n性质\n•   边缘分布：$X$ 和 $Y$ 的边缘分布也是正态分布。\n•   条件分布：给定 $X$ 的值，$Y$ 的条件分布也是正态分布。\n•   相关性：协方差矩阵的值可以用来判断 X 和 Y 之间的相关性。如果 $\\sigma_{XY} &gt; 0$，则两者正相关；如果 $\\sigma_{XY} &lt; 0$，则负相关。\n示例\n假设有一组数据描述学生的身高 \\(X\\) 和体重 \\(Y\\)，并且假设 \\((X, Y)\\) 服从双元正态分布：\n•   均值向量：\n\\[\\mu = \\begin{pmatrix}\n170 \\\\\n65\n\\end{pmatrix}\\]\n表示身高的均值为 170 厘米，体重的均值为 65 千克。 • 协方差矩阵：\n\\[\\Sigma = \\begin{pmatrix}\n100 & 20 \\\\\n20 & 25\n\\end{pmatrix}\\]\n这里，身高的方差为 100，体重的方差为 25，协方差为 20，表示身高和体重之间存在正相关关系。\n在这个示例中，如果我们知道某个学生的身高为 180 厘米，我们可以利用条件分布来预测他的体重，这个体重的预测值也是正态分布。\n我们用一个图形来展示：\n\n## 安装和加载所需的包\n#install.packages(\"plotly\")\n#install.packages(\"mvtnorm\")\nlibrary(plotly)\nlibrary(mvtnorm)\nlibrary(webshot2)\n\n# 创建网格数据\nx &lt;- seq(150, 190, length.out = 100)\n#身高150-190，等距的100个值\ny &lt;- seq(50, 80, length.out = 100)\n#体重50-80，等距的100个值\ngrid &lt;- expand.grid(X = x, Y = y)\n#生成 x 和 y 的所有组合，用于构建一个网格数据框，以便计算多元正态分布的概率密度。\n\n# 设置均值和协方差矩阵\nmu &lt;- c(170, 65)\n#设置双元正态分布的均值向量，表示均值分别为身高 170 cm 和体重 65 kg\n\nsigma &lt;- matrix(c(100, 20, 20, 25), nrow = 2)\n#设置协方差矩阵，表示身高的方差为 100，体重的方差为 25，身高和体重之间的协方差为 20\n\n# 计算概率密度\nz &lt;- dmvnorm(as.matrix(grid), mean = mu, sigma = sigma)\n#计算每个网格点上双元正态分布的概率密度。\n\n# 将概率密度矩阵转换为适合绘图的形状\nz_matrix &lt;- matrix(z, nrow = 100, ncol = 100)\n\n# 绘制三维表面图\nplot_ly(x = x, y = y, z = z_matrix, type = \"surface\") %&gt;%\n  layout(title = list(text = \"双元正态分布的三维概率密度图\", y=0.95),\n         scene = list(xaxis = list(title = \"身高 (cm)\"),\n                      yaxis = list(title = \"体重 (kg)\"),\n                      zaxis = list(title = \"概率密度\")))\n\n\nBinary normal distribution\n\n\n注：上述图像在被转换为PDF文件时，会发生报错：Quarto 文档中包含了一些生成 HTML 输出的函数（比如交互式图表或其他 HTML 小部件），但你当前的目标输出格式是 PDF。由于 PDF 是静态格式，无法直接渲染 HTML 内容，Quarto 会报错并停止执行。\n解决方案，此章节不转换为PDF格式，或者：\n如果你仍想输出 PDF，但希望将 HTML 小部件作为静态截图嵌入，可以安装 R 的 webshot 或 webshot2 包。Quarto 会利用它们将 HTML 内容转换为图片。\n需要安装：\n\ninstall.packages(\"webshot2\")\n\n然后在这段程序的前部导入该包：library(webshot2)。",
    "crumbs": [
      "Home",
      "医学统计学基础",
      "简单线性相关和回归"
    ]
  },
  {
    "objectID": "Quarto/yaml_settings_files/figure-html/quarto-LaTeX.html",
    "href": "Quarto/yaml_settings_files/figure-html/quarto-LaTeX.html",
    "title": "Quarto与LaTeX的记录",
    "section": "",
    "text": "在2025-02-23迁移博客到本网站时遇到一些问题，主要是因为在相关与回归部分使用plotly包制作了一个三维图形，在以前的Rmarkdown博客中，因为未知原因导致从2024年中的一次更新开始就无法在生成PDF文件，所以这个问题没有被发现。\n简而言之就是使用plotly绘制了一个图形后，如果Quarto被指定要生成PDF文件，需要载入更多的R包且更新TeXLive的宏包来提供支持。\n## 安装和加载所需的包\n#install.packages(\"plotly\")\n#install.packages(\"mvtnorm\")\nlibrary(plotly)\nlibrary(mvtnorm)\nlibrary(webshot2)\n\n# 创建网格数据\nx &lt;- seq(150, 190, length.out = 100)\n#身高150-190，等距的100个值\ny &lt;- seq(50, 80, length.out = 100)\n#体重50-80，等距的100个值\ngrid &lt;- expand.grid(X = x, Y = y)\n#生成 x 和 y 的所有组合，用于构建一个网格数据框，以便计算多元正态分布的概率密度。\n\n# 设置均值和协方差矩阵\nmu &lt;- c(170, 65)\n#设置双元正态分布的均值向量，表示均值分别为身高 170 cm 和体重 65 kg\n\nsigma &lt;- matrix(c(100, 20, 20, 25), nrow = 2)\n#设置协方差矩阵，表示身高的方差为 100，体重的方差为 25，身高和体重之间的协方差为 20\n\n# 计算概率密度\nz &lt;- dmvnorm(as.matrix(grid), mean = mu, sigma = sigma)\n#计算每个网格点上双元正态分布的概率密度。\n\n# 将概率密度矩阵转换为适合绘图的形状\nz_matrix &lt;- matrix(z, nrow = 100, ncol = 100)\n\n# 绘制三维表面图\nplot_ly(x = x, y = y, z = z_matrix, type = \"surface\") %&gt;%\n  layout(title = list(text = \"双元正态分布的三维概率密度图\", y=0.95),\n         scene = list(xaxis = list(title = \"身高 (cm)\"),\n                      yaxis = list(title = \"体重 (kg)\"),\n                      zaxis = list(title = \"概率密度\")))\n\n\nBinary normal distribution\n上述图像在被转换为PDF文件时，会发生报错：Quarto 文档中包含了一些生成 HTML 输出的函数（比如交互式图表或其他 HTML 小部件），但你当前的目标输出格式是 PDF。由于 PDF 是静态格式，无法直接渲染 HTML 内容，Quarto 会报错并停止执行。"
  },
  {
    "objectID": "Quarto/yaml_settings_files/figure-html/quarto-LaTeX.html#解决方案1",
    "href": "Quarto/yaml_settings_files/figure-html/quarto-LaTeX.html#解决方案1",
    "title": "Quarto与LaTeX的记录",
    "section": "\n1 解决方案1",
    "text": "1 解决方案1\n此章节不转换为PDF格式。"
  },
  {
    "objectID": "Quarto/yaml_settings_files/figure-html/quarto-LaTeX.html#解决方案2",
    "href": "Quarto/yaml_settings_files/figure-html/quarto-LaTeX.html#解决方案2",
    "title": "Quarto与LaTeX的记录",
    "section": "\n2 解决方案2",
    "text": "2 解决方案2\n增加支持：如果你仍想输出 PDF，但希望将 HTML 小部件作为静态截图嵌入，可以安装 R 的 webshot 或 webshot2 包。Quarto 会利用它们将 HTML 内容转换为图片。\n需要安装：\n\ninstall.packages(\"webshot2\")\n\n然后在这段程序的前部导入该包：library(webshot2)。\n也可以使用\n\ninstall.packages(\"webshot\")\n\n但是使用 webshot 还需要安装 PhantomJS\n\nwebshot::install_phantomjs()"
  },
  {
    "objectID": "Quarto/yaml_settings_files/figure-html/quarto-LaTeX.html#解决方案3启用-prefer-html-true-选项",
    "href": "Quarto/yaml_settings_files/figure-html/quarto-LaTeX.html#解决方案3启用-prefer-html-true-选项",
    "title": "Quarto与LaTeX的记录",
    "section": "\n3 解决方案3：启用 prefer-html: true 选项\n",
    "text": "3 解决方案3：启用 prefer-html: true 选项\n\n如果你不在乎 HTML 内容在 PDF 中不可见，可以通过添加 prefer-html: true 来跳过这个错误。这种方法会忽略 HTML 输出，PDF 中不会显示相关内容。\n\n\n在 .qmd 文件的 YAML 前置元数据中添加：\n\nformat: pdf: toc: true # 可选{yaml}"
  },
  {
    "objectID": "Quarto/yaml_settings_files/figure-html/quarto-LaTeX.html#解决方法-4检查并移除-html-输出代码",
    "href": "Quarto/yaml_settings_files/figure-html/quarto-LaTeX.html#解决方法-4检查并移除-html-输出代码",
    "title": "Quarto与LaTeX的记录",
    "section": "\n4 解决方法 4：检查并移除 HTML 输出代码\n",
    "text": "4 解决方法 4：检查并移除 HTML 输出代码\n\n如果你的目标是纯 PDF 输出，且不需要 HTML 小部件，可以检查文档中的代码块，移除或调整生成 HTML 的部分。例如：\n\n如果使用了 R 的 plotly 或 htmlwidgets，将其替换为静态图形库（如 ggplot2）。\n检查是否有 {r, results='asis'} 或其他生成 HTML 的设置，改为适合 PDF 的输出。\n\n示例：\n将交互式图表改为静态图表：\n\n# 原代码（生成 HTML）\nlibrary(plotly)\nplot_ly(data, x = ~x, y = ~y, type = \"scatter\")\n\n# 修改后（适合 PDF）\nlibrary(ggplot2)\nggplot(data, aes(x = x, y = y)) + geom_point()"
  },
  {
    "objectID": "Quarto/yaml_settings_files/figure-html/quarto-LaTeX.html#quarto调用texlive报错",
    "href": "Quarto/yaml_settings_files/figure-html/quarto-LaTeX.html#quarto调用texlive报错",
    "title": "Quarto与LaTeX的记录",
    "section": "\n5 Quarto调用TeXLive报错",
    "text": "5 Quarto调用TeXLive报错\n在使用方法一进行完善的过程中，terminal输出了一些关于TeX Live的信息：\n{bash， eval = FALSE} TeX Live infrastructure update in progress ... TeX Live infrastructure update in progress ... Detailed command logging to \"C:\\texlive\\2024\\temp\\update-self.log\" self update: texlive.infra (70084 -&gt; 73495) texlive.infra.windows (69813 -&gt; 71447) tlperl.windows (69939 -&gt; 71515) Infrastructure update finished successfully. You may now close this window.\n这是因为Quarto的预览过程中触发了TeX Live的更新，这里的输出显示已完成更新，但是preview .qmd文档仍然不顺利，怀疑没有正确更新，且因为太晚关闭了电脑，导致更新中断。\n试着从terminal对TeX Live进行更新，在cmd中使用如下命令\n\ntlmgr update --self --all\n\n你的Windows电脑可能会和我一样报错：\n\nC:\\Users\\asus&gt;tlmgr update --self --all\nLocale 'English_United States.936' is unsupported, and may crash the interpreter.\n\n这是因为：\n当你运行 tlmgr update --self --all 来更新 TeX Live 时，出现了 Locale 'English_United States.936' is unsupported, and may crash the interpreter 的警告。这表明 TeX Live 的包管理器（tlmgr）在你的系统区域设置（locale）下遇到了兼容性问题，可能是因为你的 Windows 系统使用了中文（代码页 936，简体中文 GBK）作为默认区域设置，而 tlmgr 默认期望一个支持的区域设置（如 UTF-8 或英语）。\n以下是解决这个问题的步骤：\n\n\n5.1 方案 1：检查系统区域设置\n\n\n查看当前区域设置：\n\n按 Win + R，输入 intl.cpl，回车，打开“区域”设置。\n在“格式”选项卡中，查看当前格式（可能是“中文（简体，中国）”）。\n点击“管理”选项卡 -&gt; “更改系统区域设置”，查看“当前系统区域设置”（可能是“中文（简体，中国）”）。\n\n\n\n问题原因：\n\n代码页 936（中文 GBK）不是 TeX Live 的 tlmgr 完全支持的区域设置，可能导致编码或解释器错误。\n\n\n\n\n5.2 方案 2：临时更改区域设置运行 tlmgr\n\n为了让 tlmgr 正常工作，可以临时将区域设置为英语（美国），运行更新后再改回。\n操作步骤：\n\n\n更改系统区域设置：\n\n按 Win + R，输入 intl.cpl。\n点击“管理”选项卡 -&gt; “更改系统区域设置”。\n在下拉菜单中选择“英语（美国）”（English (United States)）。\n勾选“Beta: 使用 UTF-8 提供全球语言支持”（推荐），然后点击“确定”。\n系统会提示重启，点击“立即重启”。\n\n\n\n运行更新：\n\n重启后，打开命令行（cmd）。\n\n输入：\ntlmgr update --self --all\n\n观察是否还有错误，等待更新完成。\n\n\n\n恢复区域设置（可选）：\n\n更新完成后，重复上述步骤，将区域设置改回“中文（简体，中国）”，再次重启。\n\n\n\n\n5.3 方案 3：使用环境变量绕过区域问题\n如果你不想更改系统区域设置，可以通过设置环境变量临时调整 tlmgr 的运行环境。\n操作步骤：\n\n打开命令行（cmd）。\n\n输入以下命令设置临时环境变量：\nset LC_ALL=en_US.UTF-8\n\n\n紧接着运行更新：\ntlmgr update --self --all\n\n\n检查是否成功执行。如果仍然报错，尝试：\nset LANG=en_US.UTF-8\ntlmgr update --self --all\n\n说明：\n\n\nLC_ALL 或 LANG 是控制区域设置的环境变量，设置为 en_US.UTF-8 可以让 tlmgr 在英语环境下运行，避免中文编码问题。\n这种方法无需重启，适合临时解决。\n\n\n5.4 方案 4：验证更新结果\n更新完成后，检查 TeX Live 是否正常工作： 1. 运行： tlmgr info --list installed 查看已安装的包列表，确保更新生效。 2. 返回 Quarto 项目，运行： quarto preview 确认是否还有 TeX 相关的问题。\n\n5.5 额外建议\n\n\n检查 TeX Live 安装： 如果问题持续存在，可能是 TeX Live 安装不完整。可以尝试重新安装：\n\n下载最新版 TeX Live（tug.org/texlive）。\n安装时选择“完整安装”以确保所有组件齐全。\n\n\n\n使用 PowerShell 或 WSL： 如果 cmd 仍然有问题，可以尝试在 PowerShell 或 Windows Subsystem for Linux (WSL) 中运行 tlmgr，这些环境可能更好地处理区域设置。\n\n\n5.6 推荐方案\n\n\n快速解决：用 Step 3 设置 LC_ALL=en_US.UTF-8，无需重启，最简单。\n\n彻底解决：用 Step 2 临时改为英语区域设置，更新后再改回。\n\n我采用了方案 1，在cmd中输入命令后，出现如下：\n\nC:\\Users\\asus&gt;tlmgr update --self --all\ntlmgr.pl: package repository https://mirrors.hust.edu.cn/CTAN/systems/texlive/tlnet (not verified: gpg unavailable)\ntlmgr.pl: saving backups to C:/texlive/2024/tlpkg/backups\ntlmgr.pl: no self-updates for tlmgr available\ntlmgr.pl: skipping forcibly removed package: extractbb\ntlmgr.pl: skipping forcibly removed package: extractbb.windows\n[  1/764, ??:??/??:??] update: ebgaramond [8780k] (66604 -&gt; 71069) ... done\n[  2/764, 00:16/42:39] update: ebgaramond-maths [567k] (52168 -&gt; 74174) ... done\n\n表示在更新中，这个过程大概需要45分钟左右。"
  },
  {
    "objectID": "Quarto/quarto-LaTeX.html",
    "href": "Quarto/quarto-LaTeX.html",
    "title": "Quarto与LaTeX的记录",
    "section": "",
    "text": "在2025-02-23迁移博客到本网站时遇到一些问题，主要是因为在相关与回归部分使用plotly包制作了一个三维图形，在以前的Rmarkdown博客中，因为未知原因导致从2024年中的一次更新开始就无法在生成PDF文件，所以这个问题没有被发现。\n简而言之就是使用plotly绘制如图所示的双元正态分布图形后，如果Quarto被指定要生成PDF文件，需要载入更多的R包且更新TeXLive的宏包来提供支持。\n## 安装和加载所需的包\n# install.packages(\"plotly\")\n# install.packages(\"mvtnorm\")\nlibrary(plotly)\nlibrary(mvtnorm)\nlibrary(webshot2)\n\n# 创建网格数据\nx &lt;- seq(150, 190, length.out = 100)\n#身高150-190，等距的100个值\ny &lt;- seq(50, 80, length.out = 100)\n#体重50-80，等距的100个值\ngrid &lt;- expand.grid(X = x, Y = y)\n#生成 x 和 y 的所有组合，用于构建一个网格数据框，以便计算多元正态分布的概率密度。\n\n# 设置均值和协方差矩阵\nmu &lt;- c(170, 65)\n#设置双元正态分布的均值向量，表示均值分别为身高 170 cm 和体重 65 kg\n\nsigma &lt;- matrix(c(100, 20, 20, 25), nrow = 2)\n#设置协方差矩阵，表示身高的方差为 100，体重的方差为 25，身高和体重之间的协方差为 20\n\n# 计算概率密度\nz &lt;- dmvnorm(as.matrix(grid), mean = mu, sigma = sigma)\n#计算每个网格点上双元正态分布的概率密度。\n\n# 将概率密度矩阵转换为适合绘图的形状\nz_matrix &lt;- matrix(z, nrow = 100, ncol = 100)\n\n# 绘制三维表面图\nplot_ly(x = x, y = y, z = z_matrix, type = \"surface\") %&gt;%\n  layout(title = list(text = \"双元正态分布的三维概率密度图\", y=0.95),\n         scene = list(xaxis = list(title = \"身高 (cm)\"),\n                      yaxis = list(title = \"体重 (kg)\"),\n                      zaxis = list(title = \"概率密度\")))\n\n\n双元正态分布示例\n上述图像在被转换为PDF文件时，会发生报错：Quarto 文档中包含了一些生成 HTML 输出的函数（比如交互式图表或其他 HTML 小部件），但你当前的目标输出格式是 PDF。由于 PDF 是静态格式，无法直接渲染 HTML 内容，Quarto 会报错并停止执行。",
    "crumbs": [
      "Home",
      "Quarto introduction",
      "Quarto与LaTeX的记录"
    ]
  },
  {
    "objectID": "Quarto/quarto-LaTeX.html#解决方案1",
    "href": "Quarto/quarto-LaTeX.html#解决方案1",
    "title": "Quarto与LaTeX的记录",
    "section": "\n1 解决方案1",
    "text": "1 解决方案1\n此章节不转换为PDF格式。",
    "crumbs": [
      "Home",
      "Quarto introduction",
      "Quarto与LaTeX的记录"
    ]
  },
  {
    "objectID": "Quarto/quarto-LaTeX.html#解决方案2",
    "href": "Quarto/quarto-LaTeX.html#解决方案2",
    "title": "Quarto与LaTeX的记录",
    "section": "\n2 解决方案2",
    "text": "2 解决方案2\n增加支持：如果你仍想输出 PDF，但希望将 HTML 小部件作为静态截图嵌入，可以安装 R 的 webshot 或 webshot2 包。Quarto 会利用它们将 HTML 内容转换为图片。\n需要安装：\n\ninstall.packages(\"webshot2\")\n\n然后在这段程序的前部导入该包：library(webshot2)。\n也可以使用\n\ninstall.packages(\"webshot\")\n\n但是使用 webshot 还需要安装 PhantomJS\n\nwebshot::install_phantomjs()",
    "crumbs": [
      "Home",
      "Quarto introduction",
      "Quarto与LaTeX的记录"
    ]
  },
  {
    "objectID": "Quarto/quarto-LaTeX.html#解决方案3启用-prefer-html-true-选项",
    "href": "Quarto/quarto-LaTeX.html#解决方案3启用-prefer-html-true-选项",
    "title": "Quarto与LaTeX的记录",
    "section": "\n3 解决方案3：启用 prefer-html: true 选项\n",
    "text": "3 解决方案3：启用 prefer-html: true 选项\n\n如果你不在乎 HTML 内容在 PDF 中不可见，可以通过添加 prefer-html: true 来跳过这个错误。这种方法会忽略 HTML 输出，PDF 中不会显示相关内容。\n\n\n在 .qmd 文件的 YAML 前置元数据中添加：\n\nformat: pdf: toc: true # 可选{yaml}",
    "crumbs": [
      "Home",
      "Quarto introduction",
      "Quarto与LaTeX的记录"
    ]
  },
  {
    "objectID": "Quarto/quarto-LaTeX.html#解决方法-4检查并移除-html-输出代码",
    "href": "Quarto/quarto-LaTeX.html#解决方法-4检查并移除-html-输出代码",
    "title": "Quarto与LaTeX的记录",
    "section": "\n4 解决方法 4：检查并移除 HTML 输出代码\n",
    "text": "4 解决方法 4：检查并移除 HTML 输出代码\n\n如果你的目标是纯 PDF 输出，且不需要 HTML 小部件，可以检查文档中的代码块，移除或调整生成 HTML 的部分。例如：\n\n如果使用了 R 的 plotly 或 htmlwidgets，将其替换为静态图形库（如 ggplot2）。\n检查是否有 {r, results='asis'} 或其他生成 HTML 的设置，改为适合 PDF 的输出。\n\n示例：\n将交互式图表改为静态图表：\n\n# 原代码（生成 HTML）\nlibrary(plotly)\nplot_ly(data, x = ~x, y = ~y, type = \"scatter\")\n\n# 修改后（适合 PDF）\nlibrary(ggplot2)\nggplot(data, aes(x = x, y = y)) + geom_point()",
    "crumbs": [
      "Home",
      "Quarto introduction",
      "Quarto与LaTeX的记录"
    ]
  },
  {
    "objectID": "Quarto/quarto-LaTeX.html#quarto调用texlive报错",
    "href": "Quarto/quarto-LaTeX.html#quarto调用texlive报错",
    "title": "Quarto与LaTeX的记录",
    "section": "\n5 Quarto调用TeXLive报错",
    "text": "5 Quarto调用TeXLive报错\n在使用方法一进行完善的过程中，terminal输出了一些关于TeX Live的信息：\n\nTeX Live infrastructure update in progress ... \nTeX Live infrastructure update in progress ... \nDetailed command logging to \"C:\\texlive\\2024\\temp\\update-self.log\" \nself update: texlive.infra (70084 -&gt; 73495) \ntexlive.infra.windows (69813 -&gt; 71447) \ntlperl.windows (69939 -&gt; 71515) \nInfrastructure update finished successfully. \nYou may now close this window.\n\n这是因为Quarto的预览过程中触发了TeX Live的更新，这里的输出显示已完成更新，但是preview .qmd文档仍然不顺利，怀疑没有正确更新，且因为太晚关闭了电脑，导致更新中断。\n试着从terminal对TeX Live进行更新，在cmd中使用如下命令\n\ntlmgr update --self --all\n\n你的Windows电脑可能会和我一样报错：\n\nC:\\Users\\asus&gt;tlmgr update --self --all\nLocale 'English_United States.936' is unsupported, and may crash the interpreter.\n\n这是因为：\n当你运行 tlmgr update --self --all 来更新 TeX Live 时，出现了 Locale 'English_United States.936' is unsupported, and may crash the interpreter 的警告。这表明 TeX Live 的包管理器（tlmgr）在你的系统区域设置（locale）下遇到了兼容性问题，可能是因为你的 Windows 系统使用了中文（代码页 936，简体中文 GBK）作为默认区域设置，而 tlmgr 默认期望一个支持的区域设置（如 UTF-8 或英语）。\n以下是解决这个问题的步骤：\n\n\n5.1 方案 1：检查系统区域设置\n\n\n查看当前区域设置：\n\n按 Win + R，输入 intl.cpl，回车，打开“区域”设置。\n在“格式”选项卡中，查看当前格式（可能是“中文（简体，中国）”）。\n点击“管理”选项卡 -&gt; “更改系统区域设置”，查看“当前系统区域设置”（可能是“中文（简体，中国）”）。\n\n\n\n问题原因：\n\n代码页 936（中文 GBK）不是 TeX Live 的 tlmgr 完全支持的区域设置，可能导致编码或解释器错误。\n\n\n\n\n5.2 方案 2：临时更改区域设置运行 tlmgr\n\n为了让 tlmgr 正常工作，可以临时将区域设置为英语（美国），运行更新后再改回。\n操作步骤：\n\n\n更改系统区域设置：\n\n按 Win + R，输入 intl.cpl。\n点击“管理”选项卡 -&gt; “更改系统区域设置”。\n在下拉菜单中选择“英语（美国）”（English (United States)）。\n勾选“Beta: 使用 UTF-8 提供全球语言支持”（推荐），然后点击“确定”。\n系统会提示重启，点击“立即重启”。\n\n\n\n运行更新：\n\n重启后，打开命令行（cmd）。\n\n输入：\n\ntlmgr update --self --all\n\n\n观察是否还有错误，等待更新完成。\n\n\n\n恢复区域设置（可选）：\n\n更新完成后，重复上述步骤，将区域设置改回“中文（简体，中国）”，再次重启。\n\n\n\n\n5.3 方案 3：使用环境变量绕过区域问题\n如果你不想更改系统区域设置，可以通过设置环境变量临时调整 tlmgr 的运行环境。\n操作步骤：\n\n打开命令行（cmd）。\n\n输入以下命令设置临时环境变量：\n\nset LC_ALL=en_US.UTF-8\n\n\n\n紧接着运行更新：\n\ntlmgr update --self --all\n\n\n\n检查是否成功执行。如果仍然报错，尝试：\n\nset LANG=en_US.UTF-8\ntlmgr update --self --all\n\n\n说明：\n\n\nLC_ALL 或 LANG 是控制区域设置的环境变量，设置为 en_US.UTF-8 可以让 tlmgr 在英语环境下运行，避免中文编码问题。\n这种方法无需重启，适合临时解决。\n\n\n5.4 方案 4：验证更新结果\n更新完成后，检查 TeX Live 是否正常工作： 1. 运行： tlmgr info --list installed 查看已安装的包列表，确保更新生效。 2. 返回 Quarto 项目，运行： quarto preview 确认是否还有 TeX 相关的问题。\n\n5.5 额外建议\n\n\n检查 TeX Live 安装： 如果问题持续存在，可能是 TeX Live 安装不完整。可以尝试重新安装：\n\n下载最新版 TeX Live（tug.org/texlive）。\n安装时选择“完整安装”以确保所有组件齐全。\n\n\n\n使用 PowerShell 或 WSL： 如果 cmd 仍然有问题，可以尝试在 PowerShell 或 Windows Subsystem for Linux (WSL) 中运行 tlmgr，这些环境可能更好地处理区域设置。\n\n\n5.6 推荐方案\n\n\n快速解决：用 Step 3 设置 LC_ALL=en_US.UTF-8，无需重启，最简单。\n\n彻底解决：用 Step 2 临时改为英语区域设置，更新后再改回。\n\n我采用了方案 1，在cmd中输入命令后，出现如下：\n\nC:\\Users\\asus&gt;tlmgr update --self --all\ntlmgr.pl: package repository https://mirrors.hust.edu.cn/CTAN/systems/texlive/tlnet (not verified: gpg unavailable)\ntlmgr.pl: saving backups to C:/texlive/2024/tlpkg/backups\ntlmgr.pl: no self-updates for tlmgr available\ntlmgr.pl: skipping forcibly removed package: extractbb\ntlmgr.pl: skipping forcibly removed package: extractbb.windows\n[  1/764, ??:??/??:??] update: ebgaramond [8780k] (66604 -&gt; 71069) ... done\n[  2/764, 00:16/42:39] update: ebgaramond-maths [567k] (52168 -&gt; 74174) ... done\n\n表示在更新中，这个过程大概需要45分钟左右。",
    "crumbs": [
      "Home",
      "Quarto introduction",
      "Quarto与LaTeX的记录"
    ]
  }
]