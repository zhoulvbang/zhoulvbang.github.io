# 非参数检验
## 卡方检验
### 分类资料差异比较的方法

| 资料特征 | 数据特征 |     | 完全随机设计 | |配对设计 | 随机区组 |
| :--:   | :--:     | :---- | :----  | :---- | :---- | :---- |
|  |  | 单组 | 两组 | 多组 | | |
| 分类资料 | 无序分类资料 | 二项分布直接计算概率法、正态近似法（Z检验）、率的正态近似 | 独立四格表$\chi^2$检验、Fisher确切概率法 | R×C交叉表$\chi^2$检验、Fisher确切概率法 | 配对四格表$\chi^2$检验，配对R×R列联表$\chi^2$检验 | / |
| | 等级资料 | Wilcoxon符合秩和检验 | wilcoxon秩和检验 | Kruskal-Wallis H检验 | Wilcoxon符合秩和检验 | Friedman M秩和检验 | 

### 单个率的比较
| 方法 | 内容   | 
| :--: | ------ |
| 确切概率法  | 1. 适用情形：样本量较小或$\pi_0$不靠近0.5时作单侧检验的情形。<br>2. 计算公式：<br>(1)最多有k例阳性的概率：$Pr(X\le k)$<br>(2)最少有k例阳性的概率：$Pr(X\ge k)$ |
| 正态近似法 | 1. 适用情形：样本量较大时，$n\pi,n(1-\pi)$均大于5；<br>2. 计算公式：分子为$p-\pi_0$，分母为率的标准误 |
*notice：*上式中p为样本率，$\pi_0$为给的总体率（常为理论值或标准值），n为样本含量。

## 率的比较
### 2×2交叉表数据的$\chi^2$检验
| 方法 | 情形  | 计算公式 | 
| :--: | :---- | :----    |
| 独立四格表卡方检验 | $n\ge 40$且所有的$T\ge 5$<br>$n\ge 40$且任一理论频数有$1\le T< 5$<br>当$n<40$，或任一一个格子理论频数$T<1$时 | 卡方基本公式、独立四格表专用公式<br>同上、但是需要校正<br>用四格表资料的Fisher确切概率法 |
| 正态近似法 | $n_1p_1,n_1(1-p_1),n_2p_2,n_2(1-p_2)$均大于5 | 分子为样本率之差，分母为样本率差的标准误<br>$S_{p1-p2}$为两个样本率之差的标准误，$p_c=\frac{x_1+x_2}{n_1+n_2}$为两样本的合并率 |
| 校正样本率的正态近似法 | 当$n_1p_1,n_1(1-p_1),n_2p_2,n_2(1-p_2)$不太大时 | 同上，但是需要对样本率实施“分子+2、分母+4”的校正  |

*notice：*

1. 正态近似法与卡方检验结果是很接近的。在日常计算时，因为计算简便，故常用卡方检验公式。
2. 四格表的自由度为1。
3. 四格表实际频数变动时，若周边合计数保持不变，则理论频数将不会产生变化。
4. 用$n_R$和$n_C$和n分别表示行合计、列合计和总合计，则计算每格理论数的公式为：$T_{RC}=\frac{n_R×n_C}{n}$。
5. $\chi^2$检验的基本公式：$\chi^2=\sum \frac{(A-T)^2}{T}$。
6. 校正的$\chi^2$检验的基本公式：$\chi^2=\sum \frac{(|A-T|-0.5)^2}{T}$。

### 配对设计数据的$\chi^2$检验
| 方法 | 情形 | 计算公式 | 
| :---: | :---- | :---- |
| 配对四格表卡方检验 | 当$(b+c)\ge 40$时<br>当$(b+c)<40$时 |配对卡方检验专用公式<br>校正配对卡方检验专用公式 |
| 配对R×R交叉表数据的$\chi^2$检验 | R（$R\ge2$） | $T=\frac{k-1}{k}\sum_{i=1}^{k}\frac{(n_i-m_i)^2}{n_i+m_i-2A_{ii}}$ |

*notice：*

1. 配对$\chi^2$检验的基本公式：$\chi^2=\sum \frac{(A-T)^2}{T}=\frac{(b-c)^2}{b+c}$。
2. 若b+c<40,使用校正的配对$\chi^2$检验的基本公式：$\chi^2=\sum \frac{(|b-c|-1)^2}{b+c}$。

## 独立性检验
### 2×2交叉表的独立性检验

1. 建立假设检验，确定检验水准
$H_0$:两变量之间相互独立
$H_1$:两变量之间相互独立
$\alpha=0.05$
2. 计算检验统计量
\[\chi^2=\sum_{i,j}\frac{(A_{ij}-T_{ij})^2}{T_{ij}}
\]
3. 确定P值，做出推断
4. 关联系数的计算
\[r=\sqrt{\frac{\chi^2}{\chi^2+n}}\]

### 2×2配对数据的独立性检验
### R×C样本率或构成比的比较

| 类目 | 内容 |
| :--: | :------ |
| 假设检验 | $H_0$：各组总体率（或构成比）相同。$H_1$：各组总体率（或构成比）不同（不全相同）。 |
| 计算公式 | 卡方检验基本公式，自由度为：$v=(R-1)(C-1)$ |
| 数据要求 | 1. 应用条件：不能有理论频数小于1的格子，或者不能有1/5以上的理论频数大于等于1且小于5 <br>2. 不能进行卡方检验时的解决办法：①增加样本量；②合并或删除理论频数比较小的行或列；③采用Fisher确切概率法 | 
| 卡方分割 | 多个率或多个频率分布比较的卡方检验，当结论为拒绝$H_0$时，仅表示多组之间是有差别的。若需要明确研究是那两组之间存在差别，可做率的多重比较，将R×C表分割为若干个小的四格表进行检验，并且需要根据比较的次数合理地修正检验水准$\alpha$，否则将人为地增大犯第一类错误的概率 |

*notice:*

1. 多个独立样本率的比较，根据R个独立样本的频率分布，是检验R个二项分布总体的概率是否相同，。假设对四个样本率进行比较，进行$\chi^2$检验，则它的行数为4，列数为2，其自由度为$v=(R-1)×(C-1)=(4-1)(2-1)=3$。
2. 针对行列表资料的$\chi^2$检验，若有$1/5$格子以上的理论频数小于5，即$1\le T\le5$时，应考虑增加样本量，或结合专业知识对行或列进行合并。

## 秩和检验 

# 简单线性相关和回归
## 两变量关系分析

![two variables](images\two variables.png "two variables relationship")

## 常见相关系数
### 直线相关分析基本流程

![Draw a scatterplot](images\Draw a scatterplot.png "Draw a scatterplot")

### 三类相关系数总结

| 名称 | 适用条件 | 
| :--: | :------  |
| Pearson直线相关系数 | 双变量正态分布的资料$\rightarrow$定量$\rightarrow$类比t检验、方差分析 |
| 列联系数 | 非等级资料$\rightarrow$分类$\rightarrow$类比卡方检验 |
| Spearman秩相关系数 | 不满足双变量正态分布、分布未知、等级资料$\rightarrow$定量+分类$\rightarrow$类比秩和检验 |

## 简单直线回归

### 直线回归分析的基本流程

![Draw a scatterplot](images\Draw a scatterplot.png "Draw a scatterplot")

## 直线相关与直线回归的比较

| 区别与联系 | 类目 | 内容 |
| :-: | :-: | :----------- |
| 区别 | 资料要求 | 1. <font color=Red>线性相关</font>要求X,Y服从<font color=Red>双变量正态分布</font>，对这种资料进行回归分析称为$\textrm{II}$型回归，即可以把X当自变量，也可以当因变量，反之亦然。<br>2. <font color=Red>线性回归要求<font color=Red>Y在给定X值时服从正态分布</font>，X可以是精确测量和严格控制的变量，这时的回归称为\textrm{I}型回归，即不可以把X当因变量，Y当自变量进行回归分析。 |
| | 应用 | 1. <font color=Red>线性相关用来表达两个变量间的互依关系</font>，两个变量的研究<font color=Red>地位是相等的</font>，谁做X，谁做Y都可以；<br>2. <font color=Red>线性回归用来表达两个变量间的依存变化的数量关系</font>，即一个变量（为因变量Y）如何依存于另一个变量（为自变量X）而变化，两个变量的研究<font color=Red>地位是不相等的</font>。 |
|  | 意义 | 1. 相关系数r说明具有线性关系的两个变量之间的<font color=Red>密切程度和相关方向</font>；<br>2. 回归系数b表示X每变化一个单位所导致的<font color=Red>Y的平均变化量</font>。 |
|  | r和b的取值范围 | r没有单位，而b有单位（其单位是：Y的单位/X的单位），所以导致两者的取值范围不同；<br> $-1 \le r \le 1$,$-\infty<b<+\infty$ |
| | r和b的计算公式不同 | $r=\frac{l_{xy}}{\sqrt{l_{xx}l_{yy}}}$,$b=\frac{l_{xy}}{l_{xx}}$ |
| 联系  | 符号 | 对于既可以做相关又可作回归的同一组资料，计算出r与b的正负号相同 |
| | 假设检验 | 对于同一组资料，相关系数和回归系数的假设检验等价。即有：$t_b=t_r$|
| | 相互换算 | 对于同一组资料，相关系数和回归系数可通过下式换算：$b=s\frac{S_Y}{S_X}$，<br>式中的$S_X,S_Y$分别是$X,Y$的标准差 |
| | 用回归解释相关 | 又决定系数$R^2=\frac{SS_{回}}{SS_{总}}$，当总平方和的大小决定了相关的密切程度，回归平方和越接近总平方和，则$R^2$越接近1，相关的效果越好，说明回归效果越好，相关的密切程度也越高。|


